<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>End-to-End Google Earth Engine (Full Course) - Ujjwal Nagar</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="
Introduction
Sign-up for Google Earth Engine
Complete the Class Pre-Work
Get the Course Videos
YouTube
Vimeo
Get the Course Materials
Module 1: Earth Engine Basics
01. Hello World
Exercise
Saving Your Work
02. Working with Image Collections
Exercise
03. Filtering Image Collections
Exercise
04. Creating Mosaics and Composites from ImageCollections
Exercise
05. Working with Feature Collections
Exercise
06. Importing Data
Exercise
07. Clipping Images
Exercise
08. Exporting Data
Exercise
Assignment 1
Module 2: Earth Engine Intermediate
01. Earth Engine Objects
Exercise
02. Calculating Indices
Exercise
03. Computation on ImageCollections
Exercise
04. Cloud Masking
Exercise
05. Reducers
Exercise
06. Time-Series Charts
Exercise
Assignment 2
Module 3: Supervised Classification
Introduction to Machine Learning and Supervised Classification
01. Basic Supervised Classification
Exercise
02. Accuracy Assessment
Exercise
03. Improving the Classification
Exercise
04. Exporting Classification Results
Exercise
05. Calculating Area
Exercise
Assignment 3
Module 4: Change Detection
Introduction to Change Detection
01. Spectral Index Change
Exercise
02. Spectral Distance Change
Exercise
03. Direct Classification of Change
Exercise
04. Post-classification Comparison
Exercise
Module 5: Earth Engine Apps
01. Client vs. Server
Exercise
02. Using UI Elements
Exercise
03. Building and Publishing an App
Exercise
04. Publishing the App
Exercise
05. Create a Split Panel App
Exercise
Module 6: Google Earth Engine Python API
Introduction to the Python API
Google Colab
Local Development Environment
01. Python API Syntax
Exercise
02. Automatic Conversion of Javascript Code to Python
Exercise
03. Batch Exports
Exercise
04. Using Earth Engine with XArray
Exercise
05. Automating Downloads
06. Automating Exports
07. Using the Google Earth Engine QGIS Plugin
Supplement
Guided Projects
Get the Code
Project 1: Calculating Rainfall Deviation
Project 2: Flood Mapping
Project 3: Extracting Time-Series
Project 4: LandCover Analysis
Project 5: Extracting Nighttime Lights Statistics
Learning Resources
Useful Public Repositories
Debugging Errors and Scaling Your Analysis
Data Credits
References
Composites
Supervised Classification
License
Citing and Referencing


" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="//localhost:1313/posts/end-to-end-google-earth-engine-full-course/">
  <meta property="og:site_name" content="Ujjwal Nagar">
  <meta property="og:title" content="End-to-End Google Earth Engine (Full Course)">
  <meta property="og:description" content="Introduction Sign-up for Google Earth Engine Complete the Class Pre-Work Get the Course Videos YouTube Vimeo Get the Course Materials Module 1: Earth Engine Basics 01. Hello World Exercise Saving Your Work 02. Working with Image Collections Exercise 03. Filtering Image Collections Exercise 04. Creating Mosaics and Composites from ImageCollections Exercise 05. Working with Feature Collections Exercise 06. Importing Data Exercise 07. Clipping Images Exercise 08. Exporting Data Exercise Assignment 1 Module 2: Earth Engine Intermediate 01. Earth Engine Objects Exercise 02. Calculating Indices Exercise 03. Computation on ImageCollections Exercise 04. Cloud Masking Exercise 05. Reducers Exercise 06. Time-Series Charts Exercise Assignment 2 Module 3: Supervised Classification Introduction to Machine Learning and Supervised Classification 01. Basic Supervised Classification Exercise 02. Accuracy Assessment Exercise 03. Improving the Classification Exercise 04. Exporting Classification Results Exercise 05. Calculating Area Exercise Assignment 3 Module 4: Change Detection Introduction to Change Detection 01. Spectral Index Change Exercise 02. Spectral Distance Change Exercise 03. Direct Classification of Change Exercise 04. Post-classification Comparison Exercise Module 5: Earth Engine Apps 01. Client vs. Server Exercise 02. Using UI Elements Exercise 03. Building and Publishing an App Exercise 04. Publishing the App Exercise 05. Create a Split Panel App Exercise Module 6: Google Earth Engine Python API Introduction to the Python API Google Colab Local Development Environment 01. Python API Syntax Exercise 02. Automatic Conversion of Javascript Code to Python Exercise 03. Batch Exports Exercise 04. Using Earth Engine with XArray Exercise 05. Automating Downloads 06. Automating Exports 07. Using the Google Earth Engine QGIS Plugin Supplement Guided Projects Get the Code Project 1: Calculating Rainfall Deviation Project 2: Flood Mapping Project 3: Extracting Time-Series Project 4: LandCover Analysis Project 5: Extracting Nighttime Lights Statistics Learning Resources Useful Public Repositories Debugging Errors and Scaling Your Analysis Data Credits References Composites Supervised Classification License Citing and Referencing">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:tag" content="Clippings">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="End-to-End Google Earth Engine (Full Course)">
  <meta name="twitter:description" content="Introduction Sign-up for Google Earth Engine Complete the Class Pre-Work Get the Course Videos YouTube Vimeo Get the Course Materials Module 1: Earth Engine Basics 01. Hello World Exercise Saving Your Work 02. Working with Image Collections Exercise 03. Filtering Image Collections Exercise 04. Creating Mosaics and Composites from ImageCollections Exercise 05. Working with Feature Collections Exercise 06. Importing Data Exercise 07. Clipping Images Exercise 08. Exporting Data Exercise Assignment 1 Module 2: Earth Engine Intermediate 01. Earth Engine Objects Exercise 02. Calculating Indices Exercise 03. Computation on ImageCollections Exercise 04. Cloud Masking Exercise 05. Reducers Exercise 06. Time-Series Charts Exercise Assignment 2 Module 3: Supervised Classification Introduction to Machine Learning and Supervised Classification 01. Basic Supervised Classification Exercise 02. Accuracy Assessment Exercise 03. Improving the Classification Exercise 04. Exporting Classification Results Exercise 05. Calculating Area Exercise Assignment 3 Module 4: Change Detection Introduction to Change Detection 01. Spectral Index Change Exercise 02. Spectral Distance Change Exercise 03. Direct Classification of Change Exercise 04. Post-classification Comparison Exercise Module 5: Earth Engine Apps 01. Client vs. Server Exercise 02. Using UI Elements Exercise 03. Building and Publishing an App Exercise 04. Publishing the App Exercise 05. Create a Split Panel App Exercise Module 6: Google Earth Engine Python API Introduction to the Python API Google Colab Local Development Environment 01. Python API Syntax Exercise 02. Automatic Conversion of Javascript Code to Python Exercise 03. Batch Exports Exercise 04. Using Earth Engine with XArray Exercise 05. Automating Downloads 06. Automating Exports 07. Using the Google Earth Engine QGIS Plugin Supplement Guided Projects Get the Code Project 1: Calculating Rainfall Deviation Project 2: Flood Mapping Project 3: Extracting Time-Series Project 4: LandCover Analysis Project 5: Extracting Nighttime Lights Statistics Learning Resources Useful Public Repositories Debugging Errors and Scaling Your Analysis Data Credits References Composites Supervised Classification License Citing and Referencing">
<script src="//localhost:1313/js/feather.min.js"></script>
	
	
        <link href="//localhost:1313/css/fonts.11a1877508139eac0b5b4852ceb110c35641b3533321e66e39149e901ed5756b.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="//localhost:1313/css/main.fa747a9bb099b7bfd5d71b78a6e8ca2e23a425384e48bf533f1d357aeb61d265.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="//localhost:1313/css/dark.acc27faeb64bfb288fd545d29d5ec804495d962a1c2bee862cc5f8270ee6f6f8.css" media="(prefers-color-scheme: dark)"  />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>

		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	

	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="//localhost:1313/">Ujjwal Nagar</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/tags">Tags</a>
		
		<a href="/about">About Me</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">End-to-End Google Earth Engine (Full Course)</h1>
			<div class="meta">Posted on Jan 1, 1 <span class="draft-label">DRAFT</span> </div>
		</div>
		

		

		<section class="body">
			<ul>
<li><a href="https://courses.spatialthoughts.com/#introduction">Introduction</a></li>
<li><a href="https://courses.spatialthoughts.com/#sign-up-for-google-earth-engine">Sign-up for Google Earth Engine</a></li>
<li><a href="https://courses.spatialthoughts.com/#complete-the-class-pre-work">Complete the Class Pre-Work</a></li>
<li><a href="https://courses.spatialthoughts.com/#get-the-course-videos">Get the Course Videos</a></li>
<li><a href="https://courses.spatialthoughts.com/#youtube">YouTube</a></li>
<li><a href="https://courses.spatialthoughts.com/#vimeo">Vimeo</a></li>
<li><a href="https://courses.spatialthoughts.com/#get-the-course-materials">Get the Course Materials</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-1-earth-engine-basics">Module 1: Earth Engine Basics</a></li>
<li><a href="https://courses.spatialthoughts.com/#hello-world">01. Hello World</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#saving-your-work">Saving Your Work</a></li>
<li><a href="https://courses.spatialthoughts.com/#working-with-image-collections">02. Working with Image Collections</a></li>
<li><a href="#exercise-1">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#filtering-image-collections">03. Filtering Image Collections</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-2">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#creating-mosaics-and-composites-from-imagecollections">04. Creating Mosaics and Composites from ImageCollections</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-3">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#working-with-feature-collections">05. Working with Feature Collections</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-4">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#importing-data">06. Importing Data</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-5">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#clipping-images">07. Clipping Images</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-6">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#exporting-data">08. Exporting Data</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-7">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#assignment-1">Assignment 1</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-2-earth-engine-intermediate">Module 2: Earth Engine Intermediate</a></li>
<li><a href="https://courses.spatialthoughts.com/#earth-engine-objects">01. Earth Engine Objects</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-8">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#calculating-indices">02. Calculating Indices</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-9">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#computation-on-imagecollections">03. Computation on ImageCollections</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-10">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#cloud-masking">04. Cloud Masking</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-11">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#reducers">05. Reducers</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-12">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#time-series-charts">06. Time-Series Charts</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-13">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#assignment-2">Assignment 2</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-3-supervised-classification">Module 3: Supervised Classification</a></li>
<li><a href="https://courses.spatialthoughts.com/#introduction-to-machine-learning-and-supervised-classification">Introduction to Machine Learning and Supervised Classification</a></li>
<li><a href="https://courses.spatialthoughts.com/#basic-supervised-classification">01. Basic Supervised Classification</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-14">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#accuracy-assessment">02. Accuracy Assessment</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-15">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#improving-the-classification">03. Improving the Classification</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-16">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#exporting-classification-results">04. Exporting Classification Results</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-17">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#calculating-area">05. Calculating Area</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-18">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#assignment-3">Assignment 3</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-4-change-detection">Module 4: Change Detection</a></li>
<li><a href="https://courses.spatialthoughts.com/#introduction-to-change-detection">Introduction to Change Detection</a></li>
<li><a href="https://courses.spatialthoughts.com/#spectral-index-change">01. Spectral Index Change</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-19">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#spectral-distance-change">02. Spectral Distance Change</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-20">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#direct-classification-of-change">03. Direct Classification of Change</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-21">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#post-classification-comparison">04. Post-classification Comparison</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-22">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-5-earth-engine-apps">Module 5: Earth Engine Apps</a></li>
<li><a href="https://courses.spatialthoughts.com/#client-vs.-server">01. Client vs. Server</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-23">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#using-ui-elements">02. Using UI Elements</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-24">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#building-and-publishing-an-app">03. Building and Publishing an App</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-25">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#publishing-the-app">04. Publishing the App</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-26">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#create-a-split-panel-app">05. Create a Split Panel App</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-27">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#module-6-google-earth-engine-python-api">Module 6: Google Earth Engine Python API</a></li>
<li><a href="https://courses.spatialthoughts.com/#introduction-to-the-python-api">Introduction to the Python API</a></li>
<li><a href="https://courses.spatialthoughts.com/#google-colab">Google Colab</a></li>
<li><a href="https://courses.spatialthoughts.com/#local-development-environment">Local Development Environment</a></li>
<li><a href="https://courses.spatialthoughts.com/#python-api-syntax">01. Python API Syntax</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-28">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#automatic-conversion-of-javascript-code-to-python">02. Automatic Conversion of Javascript Code to Python</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-29">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#batch-exports">03. Batch Exports</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-30">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#using-earth-engine-with-xarray">04. Using Earth Engine with XArray</a></li>
<li><a href="https://courses.spatialthoughts.com/#exercise-31">Exercise</a></li>
<li><a href="https://courses.spatialthoughts.com/#automating-downloads">05. Automating Downloads</a></li>
<li><a href="https://courses.spatialthoughts.com/#automating-exports">06. Automating Exports</a></li>
<li><a href="https://courses.spatialthoughts.com/#using-the-google-earth-engine-qgis-plugin">07. Using the Google Earth Engine QGIS Plugin</a></li>
<li><a href="https://courses.spatialthoughts.com/#supplement">Supplement</a></li>
<li><a href="https://courses.spatialthoughts.com/#guided-projects">Guided Projects</a></li>
<li><a href="https://courses.spatialthoughts.com/#get-the-code">Get the Code</a></li>
<li><a href="https://courses.spatialthoughts.com/#project-1-calculating-rainfall-deviation">Project 1: Calculating Rainfall Deviation</a></li>
<li><a href="https://courses.spatialthoughts.com/#project-2-flood-mapping">Project 2: Flood Mapping</a></li>
<li><a href="https://courses.spatialthoughts.com/#project-3-extracting-time-series">Project 3: Extracting Time-Series</a></li>
<li><a href="https://courses.spatialthoughts.com/#project-4-landcover-analysis">Project 4: LandCover Analysis</a></li>
<li><a href="https://courses.spatialthoughts.com/#project-5-extracting-nighttime-lights-statistics">Project 5: Extracting Nighttime Lights Statistics</a></li>
<li><a href="https://courses.spatialthoughts.com/#learning-resources">Learning Resources</a></li>
<li><a href="https://courses.spatialthoughts.com/#useful-public-repositories">Useful Public Repositories</a></li>
<li><a href="https://courses.spatialthoughts.com/#debugging-errors-and-scaling-your-analysis">Debugging Errors and Scaling Your Analysis</a></li>
<li><a href="https://courses.spatialthoughts.com/#data-credits">Data Credits</a></li>
<li><a href="https://courses.spatialthoughts.com/#references">References</a></li>
<li><a href="https://courses.spatialthoughts.com/#composites">Composites</a></li>
<li><a href="https://courses.spatialthoughts.com/#supervised-classification">Supervised Classification</a></li>
<li><a href="https://courses.spatialthoughts.com/#license">License</a></li>
<li><a href="https://courses.spatialthoughts.com/#citing-and-referencing">Citing and Referencing</a></li>
</ul>
<hr>
<p><img src="https://courses.spatialthoughts.com/images/spatial_thoughts_logo.png" alt=""></p>
<hr>
<h2 id="introduction">Introduction</h2>
<p>Google Earth Engine is a cloud-based platform that enables large-scale processing of satellite imagery to detect changes, map trends, and quantify differences on the Earth’s surface. This course covers the full range of topics in Earth Engine to give the participants practical skills to master the platform and implement their remote sensing projects.</p>
<p><a href="https://www.youtube.com/watch?v=jGuCnu1I2qw&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=1"><img src="https://img.youtube.com/vi/jGuCnu1I2qw/mqdefault.jpg" alt="Watch the video"></a></p>
<p><a href="https://www.youtube.com/watch?v=jGuCnu1I2qw&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=1">Watch the Video ↗</a></p>
<p><a href="https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing">Access the Presentation ↗</a></p>
<h2 id="sign-up-for-google-earth-engine">Sign-up for Google Earth Engine</h2>
<p>If you already have a Google Earth Engine account, you can skip this step.</p>
<p>Visit our <a href="https://courses.spatialthoughts.com/gee-sign-up.html">GEE Sign-Up Guide</a> for step-by-step instructions.</p>
<h2 id="complete-the-class-pre-work">Complete the Class Pre-Work</h2>
<p>This class needs about 2-hours of pre-work. Please watch the following videos to get a good understanding of remote sensing and how Earth Engine works.</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=xAyNu9HbK8s">Introduction to Remote Sensing</a>: This video introduces the remote sensing concepts, terminology and techniques.</li>
<li><a href="https://www.youtube.com/watch?v=kpfncBHZBto">Introduction to Google Earth Engine</a>: This video gives a broad overview of Google Earth Engine with selected case studies and application. The video also covers the Earth Engine architecture and how it is different than traditional remote sensing software.</li>
</ul>
<h2 id="get-the-course-videos">Get the Course Videos</h2>
<p>The course is accompanied by a set of videos covering the all the modules. These videos are recorded from our live instructor-led classes and are edited to make them easier to consume for self-study. We have 2 versions of the videos:</p>
<h2 id="youtube">YouTube</h2>
<p>We have created a YouTube Playlist with separate videos for each module to enable effective online-learning. <a href="https://www.youtube.com/playlist?list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha">Access the YouTube Playlist ↗</a></p>
<h2 id="vimeo">Vimeo</h2>
<p>We are also making the module videos available on Vimeo. These videos can be downloaded for offline learning. <a href="https://vimeo.com/showcase/11467828?share=copy">Access the Vimeo Playlist ↗</a></p>
<h2 id="get-the-course-materials">Get the Course Materials</h2>
<p>The course material and exercises are in the form of Earth Engine scripts shared via a code repository.</p>
<ol>
<li><a href="https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/End-to-End-GEE">Click this link</a> to open Google Earth Engine code editor and add the repository to your account.</li>
<li>If successful, you will have a new repository named <code>users/ujavalgandhi/End-to-End-GEE</code> in the <em>Scripts</em> tab in the <em>Reader</em> section.</li>
<li>Verify that your code editor looks like below</li>
</ol>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/repository.png" alt="Code Editor After Adding the Class Repository"></p>
<p>Code Editor After Adding the Class Repository</p>
<p>If you do not see the repository in the <em>Reader</em> section, click <em>Refresh repository cache</em> button in your <em>Scripts</em> tab and it will show up.</p>
<p><img src="https://courses.spatialthoughts.com/images/common/repository_cache.png" alt="Refresh repository cache"></p>
<p>Refresh repository cache</p>
<p>There are several slide decks containing useful information and references. You can access all the presentations used in the course from the links below.</p>
<ul>
<li>Introduction and course overview [<a href="https://docs.google.com/presentation/d/1q8HRDTqgQEp3Hmi8IG0T7djPLTC1wRig3jXrwFTmoVE/edit?usp=sharing">Presentation ↗</a>]</li>
<li>Map/Reduce Programming Concepts [<a href="https://docs.google.com/presentation/d/10qOyxhubkwnsAVjniW54ETgwUHq3DXYKo3HGb6Gemi0/edit?usp=sharing">Presentation ↗</a>]</li>
<li>Introduction to Machine Learning &amp; Supervised Classification [<a href="https://docs.google.com/presentation/d/19L1b5vsxb38xS8GlHNKOjvPZ0IGqDhv93681btMEL5w/edit?usp=sharing">Presentation ↗</a>]</li>
<li>Introduction to Change Detection [<a href="https://docs.google.com/presentation/d/1vdFTWJ61yDuVfbfhpnumQ8zuMPGwGcHpHsBTRgo_o5I/edit?usp=sharing">Presentation ↗</a>]</li>
<li>Introduction to Earth Engine Apps [<a href="https://docs.google.com/presentation/d/1u4Q91OqT9_OS4m1OWMm3uRUgu_oseqDUxHV-8mpzGz4/edit?usp=sharing">Presentation ↗</a>]</li>
<li>Introduction to Google Earth Engine Python API [<a href="https://docs.google.com/presentation/d/1hPVRnxp2Vp1VHXBtu36SH_UtEOjPz70KcDV-zGIin3U/edit?usp=sharing">Presentation ↗</a>]</li>
</ul>
<h2 id="module-1-earth-engine-basics">Module 1: Earth Engine Basics</h2>
<p>Module 1 is designed to give you basic skills to be able to find datasets you need for your project, filter them to your region of interest, apply basic processing and export the results. Mastering this will allow you to start using Earth Engine for your project quickly and save a lot of time pre-processing the data.</p>
<p><a href="https://www.youtube.com/watch?v=daYhxVVIpJU&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=2"><img src="https://img.youtube.com/vi/daYhxVVIpJU/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=daYhxVVIpJU&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=2">Watch the Video ↗</a></p>
<h2 id="01-hello-world">01. Hello World</h2>
<p>This script introduces the basic Javascript syntax and the video covers the programming concepts you need to learn when using Earth Engine. To learn more, visit <a href="https://developers.google.com/earth-engine/tutorials/tutorial_js_01">Introduction to JavaScript for Earth Engine</a> section of the Earth Engine User Guide.</p>
<p>The <em>Code Editor</em> is an Integrated Development Environment (IDE) for Earth Engine Javascript API.. It offers an easy way to type, debug, run and manage code. Type the code below and click <em>Run</em> to execute it and see the output in the <em>Console</em> tab.</p>
<blockquote>
<p>Tip: You can use the keyboard shortcut <em>Ctrl+Enter</em> to run the code in the Code Editor</p>
</blockquote>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/hello_world.png" alt="Hello World"></p>
<p>Hello World</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F01b_Hello_World_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Hello World&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Variables
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> city <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Bengaluru&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;India&#39;</span>;
</span></span><span style="display:flex;"><span>print(city, country);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> population <span style="color:#f92672">=</span> <span style="color:#ae81ff">8400000</span>;
</span></span><span style="display:flex;"><span>print(population);
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> List
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> majorCities <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;Mumbai&#39;</span>, <span style="color:#e6db74">&#39;Delhi&#39;</span>, <span style="color:#e6db74">&#39;Chennai&#39;</span>, <span style="color:#e6db74">&#39;Kolkata&#39;</span>];
</span></span><span style="display:flex;"><span>print(majorCities);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#a6e22e">Dictionary</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> cityData <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;city&#39;</span>: city,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;population&#39;</span>: <span style="color:#ae81ff">8400000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;elevation&#39;</span>: <span style="color:#ae81ff">930</span>
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>print(cityData);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> greet <span style="color:#f92672">=</span> function(name) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;Hello &#39;</span> <span style="color:#f92672">+</span> name;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>print(greet(<span style="color:#e6db74">&#39;World&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is a comment
</span></span></code></pre></div><h3 id="exercise">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F01c_Hello_World_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// These are the 5 largest cities in the world: 
</span></span><span style="display:flex;"><span>// Tokyo, Delhi, Shanghai, Mexico City, Sao Paulo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Create a list named &#39;largeCities&#39;
</span></span><span style="display:flex;"><span>// The list should have names of all the above cities
</span></span><span style="display:flex;"><span>// Print the list 
</span></span></code></pre></div><h3 id="saving-your-work">Saving Your Work</h3>
<p>When you modify any script for the course repository, you may want to save a copy for yourself. If you try to click the <em>Save</em> button, you will get an error message like below</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/setup1.png" alt=""></p>
<p>This is because the shared class repository is a <em>Read-only</em> repository. You can click <em>Yes</em> to save a copy in your repository. If this is the first time you are using Earth Engine, you will be prompted to choose a <em>Earth Engine username</em>. Choose the name carefully, as it cannot be changed once created.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/setup2.png" alt=""></p>
<p>After entering your username, your home folder will be created. After that, you will be prompted to enter a new repository. A repository can help you organize and share code. Your account can have multiple repositories and each repository can have multiple scripts inside it. To get started, you can create a repository named <em>default</em>. Finally, you will be able to save the script.</p>
<h2 id="02-working-with-image-collections">02. Working with Image Collections</h2>
<p>Most datasets in Earth Engine come as a <code>ImageCollection</code>. An ImageCollection is a dataset that consists of images takes at different time and locations - usually from the same satellite or data provider. You can load a collection by searching the <a href="https://developers.google.com/earth-engine/datasets">Earth Engine Data Catalog</a> for the <em>ImageCollection ID</em>. Search for the <em>Sentinel-2 Level 1C</em> dataset and you will find its id <code>COPERNICUS/S2_SR</code>. Visit the <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2">Sentinel-2, Level 1C page</a> and see <em>Explore in Earth Engine</em> section to find the code snippet to load and visualize the collection. This snippet is a great starting point for your work with this dataset. Click the <strong>Copy Code Sample</strong> button and paste the code into the code editor. Click <em>Run</em> and you will see the image tiles load in the map.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/image_collection1.png" alt=""></p>
<p>In the code snippet, You will see a function <code>Map.setCenter()</code> which sets the viewport to a specific location and zoom level. The function takes the X coordinate (longitude), Y coordinate (latitude) and Zoom Level parameters. Replace the X and Y coordinates with the coordinates of your city and click <em>Run</em> to see the images of your city.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/image_collection2.png" alt=""></p>
<h3 id="exercise-1">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F02c_Image_Collections_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Find the &#39;Sentinel-2 Level-1C&#39; dataset page
</span></span><span style="display:flex;"><span>// https://developers.google.com/earth-engine/datasets
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Copy/paste the code snippet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// Change the code to display images for your home city
</span></span></code></pre></div><h2 id="03-filtering-image-collections">03. Filtering Image Collections</h2>
<p>The collection contains all imagery ever collected by the sensor. The entire collections are not very useful. Most applications require a subset of the images. We use <strong>filters</strong> to select the appropriate images. There are many types of filter functions, look at <code>ee.Filter...</code> module to see all available filters. Select a filter and then run the <code>filter()</code> function with the filter parameters.</p>
<p>We will learn about 3 main types of filtering techniques</p>
<ul>
<li><strong>Filter by metadata</strong>: You can apply a filter on the image metadata using filters such as <code>ee.Filter.eq()</code>, <code>ee.Filter.lt()</code> etc. You can filter by PATH/ROW values, Orbit number, Cloud cover etc.</li>
<li><strong>Filter by date</strong>: You can select images in a particular date range using filters such as <code>ee.Filter.date()</code>.</li>
<li><strong>Filter by location</strong>: You can select the subset of images with a bounding box, location or geometry using the <code>ee.Filter.bounds()</code>. You can also use the drawing tools to draw a geometry for filtering.</li>
</ul>
<p>After applying the filters, you can use the <code>size()</code> function to check how many images match the filters.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/filters.png" alt=""></p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F03b_Filtering_Image_Collection_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Point([<span style="color:#ae81ff">77.60412933051538</span>, <span style="color:#ae81ff">12.952912912328241</span>])
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Filter by metadata
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Filter by date
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Filter by location
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Let<span style="color:#e6db74">&#39;s apply all the 3 filters together on the collection</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> First apply metadata fileter
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered1 <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>));
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply date filter on the results
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered2 <span style="color:#f92672">=</span> filtered1<span style="color:#f92672">.</span>filter(
</span></span><span style="display:flex;"><span>  ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Lastly apply the location filter
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered3 <span style="color:#f92672">=</span> filtered2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Instead of applying filters one after the other, we can <span style="color:#e6db74">&#39;chain&#39;</span> them
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the <span style="color:#f92672">.</span> notation to apply all the filters together
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>print(filtered<span style="color:#f92672">.</span>size());
</span></span></code></pre></div><h3 id="exercise-2">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F03c_Filtering_Image_Collection_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Point([<span style="color:#ae81ff">77.60412933051538</span>, <span style="color:#ae81ff">12.952912912328241</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(filtered<span style="color:#f92672">.</span>size());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Delete the <span style="color:#e6db74">&#39;geometry&#39;</span> variable
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a point at your chosen location
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Change the filter to find images from January <span style="color:#ae81ff">2023</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Note: If you are <span style="color:#f92672">in</span> a very cloudy region, 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> make sure to adjust the CLOUDY_PIXEL_PERCENTAGE
</span></span></code></pre></div><h2 id="04-creating-mosaics-and-composites-from-imagecollections">04. Creating Mosaics and Composites from ImageCollections</h2>
<p>The default order of the collection is by date. So when you display the collection, it implicitly creates a mosaic with the latest pixels on top. You can call <code>.mosaic()</code> on a ImageCollection to create a mosaic image from the pixels at the top.</p>
<p>We can also create a composite image by applying selection criteria to each pixel from all pixels in the stack. Here we use the <code>median()</code> function to create a composite where each pixel value is the median of all pixels from the stack.</p>
<blockquote>
<p>Tip: If you need to create a mosaic where the images are in a specific order, you can use the <code>.sort()</code> function to sort your collection by a property first.</p>
</blockquote>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/mosaic_composite.png" alt="Mosaic vs. Composite"></p>
<p>Mosaic vs. Composite</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F04b_Mosaics_and_Composites_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Point([<span style="color:#ae81ff">77.60412933051538</span>, <span style="color:#ae81ff">12.952912912328241</span>]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> mosaic <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>mosaic();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> medianComposite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(filtered, rgbVis, <span style="color:#e6db74">&#39;Filtered Collection&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(mosaic, rgbVis, <span style="color:#e6db74">&#39;Mosaic&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(medianComposite, rgbVis, <span style="color:#e6db74">&#39;Median Composite&#39;</span>);
</span></span></code></pre></div><h3 id="exercise-3">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F04c_Mosaics_and_Composites_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a median composite <span style="color:#66d9ef">for</span> the year <span style="color:#ae81ff">2020</span> <span style="color:#f92672">and</span> load it to the map
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Compare both the composites to see the changes <span style="color:#f92672">in</span> your city
</span></span></code></pre></div><h2 id="05-working-with-feature-collections">05. Working with Feature Collections</h2>
<p>Feature Collections are similar to Image Collections - but they contain <em>Features</em>, not images. They are equivalent to Vector Layers in a GIS. We can load, filter and display Feature Collections using similar techniques that we have learned so far.</p>
<p>Search for <em>GAUL Second Level Administrative Boundaries</em> and load the collection. This is a global collection that contains all Admin2 boundaries. We can apply a filter using the <code>ADM1_NAME</code> property to get all Admin2 boundaries (i.e. Districts) from a state.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/feature_collection.png" alt=""></p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F05b_Feature_Collections_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> karnataka <span style="color:#f92672">=</span> admin2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM1_NAME&#39;</span>, <span style="color:#e6db74">&#39;Karnataka&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visParams <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;color&#39;</span>: <span style="color:#e6db74">&#39;red&#39;</span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(karnataka, visParams, <span style="color:#e6db74">&#39;Karnataka Districts&#39;</span>);
</span></span></code></pre></div><h3 id="exercise-4">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F05c_Feature_Collections_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(admin2, {color: <span style="color:#e6db74">&#39;grey&#39;</span>}, <span style="color:#e6db74">&#39;All Admin2 Polygons&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply filters to select your chosen Admin2 region
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the results <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;red&#39;</span> color
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint1: Switch to the <span style="color:#e6db74">&#39;Inspector&#39;</span> tab <span style="color:#f92672">and</span> click on any
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> polygon to know its properties <span style="color:#f92672">and</span> their values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint2: Many countries <span style="color:#66d9ef">do</span> <span style="color:#f92672">not</span> have unique names <span style="color:#66d9ef">for</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Admin2 regions<span style="color:#f92672">.</span> Make sure to apply a filter to select
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the Admin1 region that contains your chosen Admin2 region
</span></span></code></pre></div><h2 id="06-importing-data">06. Importing Data</h2>
<p>You can import vector or raster data into Earth Engine. We will now import a shapefile of <a href="https://bit.ly/ghs-ucdb-shapefile">Urban Centres</a> from JRC’s GHS Urban Centre Database (GHS-UCDB). Unzip the <code>ghs_urban_centers.zip</code> into a folder on your computer. In the Code Editor, go to <em>Assets → New → Table Upload → Shape Files</em>. Select the <code>.shp</code>, <code>.shx</code>, <code>.dbf</code> and .<code>prj</code> files. Enter <code>ghs_urban_centers</code> as the <em>Asset Name</em> and click <em>Upload</em>. Once the upload and ingest finishes, you will have a new asset in the <em>Assets</em> tab. The shapefile is imported as a Feature Collection in Earth Engine. Select the <code>ghs_urban_centers</code> asset and click <em>Import</em>. You can then visualize the imported data.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/import.png" alt="Importing a Shapefile"></p>
<p>Importing a Shapefile</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F06b_Import_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Let<span style="color:#e6db74">&#39;s import some data to Earth Engine</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Upload the <span style="color:#e6db74">&#39;GHS Urban Centers&#39;</span> database from JRC
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> https:<span style="color:#f92672">//</span>ghsl<span style="color:#f92672">.</span>jrc<span style="color:#f92672">.</span>ec<span style="color:#f92672">.</span>europa<span style="color:#f92672">.</span>eu<span style="color:#f92672">/</span>ghs_stat_ucdb2015mt_r2019a<span style="color:#f92672">.</span>php
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Download the shapefile from https:<span style="color:#f92672">//</span>bit<span style="color:#f92672">.</span>ly<span style="color:#f92672">/</span>ghs<span style="color:#f92672">-</span>ucdb<span style="color:#f92672">-</span>shapefile
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Unzip <span style="color:#f92672">and</span> upload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Import the collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Visualize the collection
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(urban, {color: <span style="color:#e6db74">&#39;blue&#39;</span>}, <span style="color:#e6db74">&#39;Urban Areas&#39;</span>);
</span></span></code></pre></div><h3 id="exercise-5">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F06c_Import_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>);
</span></span><span style="display:flex;"><span>print(urban<span style="color:#f92672">.</span>first());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply a filter to select only large urban centers
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">in</span> your country <span style="color:#f92672">and</span> display it on the map<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Select all urban centers <span style="color:#f92672">in</span> your country with
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> a population greater than <span style="color:#ae81ff">1000000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint1: Use the property <span style="color:#e6db74">&#39;CTR_MN_NM&#39;</span> containing country names
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint2: Use the property <span style="color:#e6db74">&#39;P15&#39;</span> containing <span style="color:#ae81ff">2015</span> Population
</span></span></code></pre></div><h2 id="07-clipping-images">07. Clipping Images</h2>
<p>It is often desirable to clip the images to your area of interest. You can use the <code>clip()</code> function to mask out an image using a geometry.</p>
<blockquote>
<p>While in a Desktop software, clipping is desirable to remove unnecessary portion of a large image and save computation time, in Earth Engine clipping can actually increase the computation time. As described in the <a href="https://developers.google.com/earth-engine/guides/best_practices?hl=en#if-you-dont-need-to-clip,-dont-use-clip">Earth Engine Coding Best Practices</a> guide, avoid clipping the images or do it at the end of your script.</p>
</blockquote>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/clipping.png" alt="Original vs. Clipped Image"></p>
<p>Original vs. Clipped Image</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F07b_Clipping_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find the name of the urban centre
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> by adding the layer to the map <span style="color:#f92672">and</span> using Inspector<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> urban
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;UC_NM_MN&#39;</span>, <span style="color:#e6db74">&#39;Bengaluru&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;CTR_MN_NM&#39;</span>, <span style="color:#e6db74">&#39;India&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], 
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median(); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> clipped <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>clip(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(clipped, rgbVis, <span style="color:#e6db74">&#39;Clipped&#39;</span>);
</span></span></code></pre></div><h3 id="exercise-6">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F07c_Clipping_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Add the imported table to the Map
</span></span><span style="display:flex;"><span>// Use the Inspector to find the id of your home city or any urban area of your choice
</span></span><span style="display:flex;"><span>// Change the filter to use the id of the selected feature
</span></span></code></pre></div><h2 id="08-exporting-data">08. Exporting Data</h2>
<p>Earth Engine allows for exporting both vector and raster data to be used in an external program. Vector data can be exported as a <code>CSV</code> or a <code>Shapefile</code>, while Rasters can be exported as <code>GeoTIFF</code> files. We will now export the Sentinel-2 Composite as a GeoTIFF file.</p>
<blockquote>
<p>Tip: Code Editor supports autocompletion of API functions using the combination <em>Ctrl+Space</em>. Type a few characters of a function and press <em>Ctrl+Space</em> to see autocomplete suggestions. You can also use the same key combination to fill all parameters of the function automatically.</p>
</blockquote>
<p>Once you run this script, the <em>Tasks</em> tab will be highlighted. Switch to the tab and you will see the tasks waiting. Click <em>Run</em> next to each task to start the process.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/export_task01.png" alt=""></p>
<p>On clicking the <em>Run</em> button, you will be prompted for a confirmation dialog. Verify the settings and click <em>Run</em> to start the export.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/export_task02.png" alt=""></p>
<p>Once the Export finishes, a GeoTiff file for each export task will be added to your Google Drive in the specified folder. You can download them and use it in a GIS software.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/exporting_data.png" alt="Visualized vs. Raw Composite"></p>
<p>Visualized vs. Raw Composite</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F08b_Export_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/ghs_urban_centers&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> urban
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;UC_NM_MN&#39;</span>, <span style="color:#e6db74">&#39;Bengaluru&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;CTR_MN_NM&#39;</span>, <span style="color:#e6db74">&#39;India&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], 
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median(); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> clipped <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>clip(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(clipped, rgbVis, <span style="color:#e6db74">&#39;Clipped&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> exportImage <span style="color:#f92672">=</span> clipped<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export raw image with original pixel values
</span></span><span style="display:flex;"><span>Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toDrive({
</span></span><span style="display:flex;"><span>    image: exportImage,
</span></span><span style="display:flex;"><span>    description: <span style="color:#e6db74">&#39;Bangalore_Composite_Raw&#39;</span>,
</span></span><span style="display:flex;"><span>    folder: <span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>    fileNamePrefix: <span style="color:#e6db74">&#39;bangalore_composite_raw&#39;</span>,
</span></span><span style="display:flex;"><span>    region: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export visualized image as colorized RGB image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Rather than exporting raw bands, we can apply a rendered image
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> visualize() function allows you to apply the same parameters 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> that are used <span style="color:#f92672">in</span> earth engine which exports a <span style="color:#ae81ff">3</span><span style="color:#f92672">-</span>band RGB image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Note: Visualized images are <span style="color:#f92672">not</span> suitable <span style="color:#66d9ef">for</span> analysis
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visualized <span style="color:#f92672">=</span> clipped<span style="color:#f92672">.</span>visualize(rgbVis);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toDrive({
</span></span><span style="display:flex;"><span>    image: visualized,
</span></span><span style="display:flex;"><span>    description: <span style="color:#e6db74">&#39;Bangalore_Composite_Visualized&#39;</span>,
</span></span><span style="display:flex;"><span>    folder: <span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>    fileNamePrefix: <span style="color:#e6db74">&#39;bangalore_composite_visualized&#39;</span>,
</span></span><span style="display:flex;"><span>    region: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="exercise-7">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A01-Earth-Engine-Basics%2F08c_Export_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Write the <span style="color:#66d9ef">export</span> function to <span style="color:#66d9ef">export</span> the results <span style="color:#66d9ef">for</span> your chosen urban area
</span></span></code></pre></div><h2 id="assignment-1">Assignment 1</h2>
<p>Load the Night Lights Data for May 2015 and May 2020. Compare the imagery for your region and find the changes in the city due to COVID-19 effect.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/assignment1.png" alt="Assignment1 Expected Output"></p>
<p>Assignment1 Expected Output</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3AAssignments%2FAssignment1">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Assignment
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export the Night Lights images <span style="color:#66d9ef">for</span> May,<span style="color:#ae81ff">2015</span> <span style="color:#f92672">and</span> May,<span style="color:#ae81ff">2020</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Workflow:
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the VIIRS Nighttime Day<span style="color:#f92672">/</span>Night Band Composites collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Filter the collection to the date range
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Extract the <span style="color:#e6db74">&#39;avg_rad&#39;</span> band which represents the nighttime lights
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Clip the image to the geometry of your city
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export the resulting image as a GeoTIFF file<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint1: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> There are <span style="color:#ae81ff">2</span> VIIRS Nighttime Day<span style="color:#f92672">/</span>Night collections
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the one that corrects <span style="color:#66d9ef">for</span> stray light
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint2: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The collection contains <span style="color:#ae81ff">1</span> global image per month
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> After filtering <span style="color:#66d9ef">for</span> the month, there will be only <span style="color:#ae81ff">1</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can use the following technique to extract that image
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>first())
</span></span></code></pre></div><h2 id="module-3-supervised-classification">Module 3: Supervised Classification</h2>
<h2 id="introduction-to-machine-learning-and-supervised-classification">Introduction to Machine Learning and Supervised Classification</h2>
<p>Supervised classification is arguably the most important classical machine learning techniques in remote sensing. Applications range from generating Land Use/Land Cover maps to change detection. Google Earth Engine is unique suited to do supervised classification at scale. The interactive nature of Earth Engine development allows for iterative development of supervised classification workflows by combining many different datasets into the model. This module covers basic supervised classification workflow, accuracy assessment, hyperparameter tuning and change detection.</p>
<p><a href="https://www.youtube.com/watch?v=lULwcRpkMv8&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=4"><img src="https://img.youtube.com/vi/lULwcRpkMv8/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=lULwcRpkMv8&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=4">Watch the Video ↗</a></p>
<h2 id="01-basic-supervised-classification">01. Basic Supervised Classification</h2>
<p>We will learn how to do a basic land cover classification using training samples collected from the Code Editor using the High Resolution basemap imagery provided by Google Maps. This method requires no prior training data and is quite effective to generate high quality classification samples anywhere in the world. The goal is to classify each source pixel into one of the following classes - urban, bare, water or vegetation. Using the drawing tools in the code editor, you create 4 new feature collection with points representing pixels of that class. Each feature collection has a property called <code>landcover</code> with values of 0, 1, 2 or 3 indicating whether the feature collection represents urban, bare, water or vegetation respectively. We then train a <em>Random Forest</em> classifier using these training set to build a model and apply it to all the pixels of the image to create a 4 class image.</p>
<blockquote>
<p>Fun fact: The classifiers in Earth Engine API have names starting with <strong>smile</strong> - such as <code>ee.Classifier.smileRandomForest()</code>. The <em>smile</em> part refers to the <a href="https://haifengl.github.io/index.html">Statistical Machine Intelligence and Learning Engine (SMILE)</a> JAVA library which is used by Google Earth Engine to implement these algorithms.</p>
</blockquote>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/classified.png" alt="Supervised Classification Output"></p>
<p>Supervised Classification Output</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F01d_Basic_Supervised_Classification_(noimport)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bangalore <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> bangalore<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The following collections were created using the 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Drawing Tools <span style="color:#f92672">in</span> the code editor 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/urban_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bare <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/bare_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> water <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/water_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> vegetation <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/vegetation_gcps&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;image&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcps <span style="color:#f92672">=</span> urban<span style="color:#f92672">.</span>merge(bare)<span style="color:#f92672">.</span>merge(water)<span style="color:#f92672">.</span>merge(vegetation);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: gcps, 
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>], 
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>, 
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Choose a <span style="color:#ae81ff">4</span><span style="color:#f92672">-</span>color palette
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Assign a color <span style="color:#66d9ef">for</span> each <span style="color:#66d9ef">class</span> <span style="color:#f92672">in</span> the following order
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Urban, Bare, Water, Vegetation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the GCPs
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We use the style() function to style the GCPs
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List(palette);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> landcover <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcpsStyled <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(
</span></span><span style="display:flex;"><span>  landcover<span style="color:#f92672">.</span>map(function(lc){
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> color <span style="color:#f92672">=</span> palette<span style="color:#f92672">.</span>get(landcover<span style="color:#f92672">.</span>indexOf(lc));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> markerStyle <span style="color:#f92672">=</span> { color: <span style="color:#e6db74">&#39;white&#39;</span>, pointShape: <span style="color:#e6db74">&#39;diamond&#39;</span>, 
</span></span><span style="display:flex;"><span>      pointSize: <span style="color:#ae81ff">4</span>, width: <span style="color:#ae81ff">1</span>, fillColor: color};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> gcps<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;landcover&#39;</span>, lc))
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">.</span>map(function(point){
</span></span><span style="display:flex;"><span>                  <span style="color:#66d9ef">return</span> point<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#39;style&#39;</span>, markerStyle)
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>      }))<span style="color:#f92672">.</span>flatten();
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(gcpsStyled<span style="color:#f92672">.</span>style({styleProperty:<span style="color:#e6db74">&#34;style&#34;</span>}), {}, <span style="color:#e6db74">&#39;GCPs&#39;</span>)
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(gcpsStyled)
</span></span></code></pre></div><h3 id="exercise-8">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F01c_Basic_Supervised_Classification_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Perform supervised classification <span style="color:#66d9ef">for</span> your city
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Delete the geometry below <span style="color:#f92672">and</span> draw a polygon
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> over your chosen city
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Polygon([[
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">77.4149</span>, <span style="color:#ae81ff">13.1203</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">77.4149</span>, <span style="color:#ae81ff">12.7308</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">77.8090</span>, <span style="color:#ae81ff">12.7308</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">77.8090</span>, <span style="color:#ae81ff">13.1203</span>]
</span></span><span style="display:flex;"><span>]]);
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">3000</span>, bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>]};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;image&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add training points <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">4</span> classes
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Assign the <span style="color:#e6db74">&#39;landcover&#39;</span> property as follows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> urban: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> bare: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> water: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> vegetation: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> After adding points, uncomments lines below
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> gcps <span style="color:#f92672">=</span> urban<span style="color:#f92672">.</span>merge(bare)<span style="color:#f92672">.</span>merge(water)<span style="color:#f92672">.</span>merge(vegetation);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   collection: gcps, 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>], 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> });
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> print(training);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   features: training,  
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>, 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>   inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> });
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Choose a <span style="color:#ae81ff">4</span><span style="color:#f92672">-</span>color palette
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Assign a color <span style="color:#66d9ef">for</span> each <span style="color:#66d9ef">class</span> <span style="color:#f92672">in</span> the following order
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Urban, Bare, Water, Vegetation
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span></code></pre></div><h2 id="02-accuracy-assessment">02. Accuracy Assessment</h2>
<p>It is important to get a quantitative estimate of the accuracy of the classification. To do this, a common strategy is to divide your training samples into 2 random fractions - one used for <em>training</em> the model and the other for <em>validation</em> of the predictions. Once a classifier is trained, it can be used to classify the entire image. We can then compare the classified values with the ones in the validation fraction. We can use the <code>ee.Classifier.confusionMatrix()</code> method to calculate a <em>Confusion Matrix</em> representing expected accuracy.</p>
<p>Classification results are evaluated based on the following metrics</p>
<ul>
<li><strong>Overall Accuracy</strong>: How many samples were classified correctly.</li>
<li><strong>Producer’s Accuracy</strong>: How well did the classification predict each class.</li>
<li><strong>Consumer’s Accuracy (Reliability)</strong>: How reliable is the prediction in each class.</li>
<li><strong>Kappa Coefficient</strong>: How well the classification performed as compared to random assignment.</li>
</ul>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/accuracy_assessment.png" alt="Accuracy Assessment"></p>
<p>Accuracy Assessment</p>
<blockquote>
<p>Don’t get carried away tweaking your model to give you the highest validation accuracy. You must use both qualitative measures (such as visual inspection of results) along with quantitative measures to assess the results.</p>
</blockquote>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F02b_Accuracy_Assessment_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> basin <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#34;WWF/HydroSHEDS/v1/Basins/hybas_7&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#34;users/ujavalgandhi/e2e/arkavathy_gcps&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> arkavathy <span style="color:#f92672">=</span> basin<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;HYBAS_ID&#39;</span>, <span style="color:#ae81ff">4071139640</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> arkavathy<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;image&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a random column <span style="color:#f92672">and</span> split the GCPs into training <span style="color:#f92672">and</span> validation set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>randomColumn();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This being a simpler classification, we take <span style="color:#ae81ff">60</span><span style="color:#f92672">%</span> points
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> validation<span style="color:#f92672">.</span> Normal recommended ratio is
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">70</span><span style="color:#f92672">%</span> training, <span style="color:#ae81ff">30</span><span style="color:#f92672">%</span> validation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> trainingGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validationGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>gte(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: trainingGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>,
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Accuracy Assessment
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use classification map to assess accuracy using the validation fraction
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> of the overall training set created above<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> test <span style="color:#f92672">=</span> classified<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: validationGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> testConfusionMatrix <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>errorMatrix(<span style="color:#e6db74">&#39;landcover&#39;</span>, <span style="color:#e6db74">&#39;classification&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Printing of confusion matrix may time out<span style="color:#f92672">.</span> Alternatively, you can <span style="color:#66d9ef">export</span> it as CSV
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Confusion Matrix&#39;</span>, testConfusionMatrix);
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Accuracy&#39;</span>, testConfusionMatrix<span style="color:#f92672">.</span>accuracy());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Alternate workflow 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is similar to machine learning practice
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validation <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: validationGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> test <span style="color:#f92672">=</span> validation<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> testConfusionMatrix <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>errorMatrix(<span style="color:#e6db74">&#39;landcover&#39;</span>, <span style="color:#e6db74">&#39;classification&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Printing of confusion matrix may time out<span style="color:#f92672">.</span> Alternatively, you can <span style="color:#66d9ef">export</span> it as CSV
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Confusion Matrix&#39;</span>, testConfusionMatrix);
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Accuracy&#39;</span>, testConfusionMatrix<span style="color:#f92672">.</span>accuracy());
</span></span></code></pre></div><h3 id="exercise-9">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F02c_Accuracy_Assessment_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/arkavathy_2019_composite&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>randomColumn();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> trainingGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validationGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>gte(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: trainingGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>,
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Accuracy Assessment
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use classification map to assess accuracy using the validation fraction
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> of the overall training set created above<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> test <span style="color:#f92672">=</span> classified<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: validationGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>,
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> testConfusionMatrix <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>errorMatrix(<span style="color:#e6db74">&#39;landcover&#39;</span>, <span style="color:#e6db74">&#39;classification&#39;</span>);
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Confusion Matrix&#39;</span>, testConfusionMatrix);
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Accuracy&#39;</span>, testConfusionMatrix<span style="color:#f92672">.</span>accuracy());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate <span style="color:#f92672">and</span> print the following assessment metrics
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">1.</span> Producer<span style="color:#e6db74">&#39;s accuracy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">2.</span> Consumer<span style="color:#e6db74">&#39;s accuracy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">3.</span> F1<span style="color:#f92672">-</span>score
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: Look at the ee<span style="color:#f92672">.</span>ConfusionMatrix module <span style="color:#66d9ef">for</span> appropriate methods
</span></span></code></pre></div><h2 id="03-improving-the-classification">03. Improving the Classification</h2>
<p>The Earth Engine data-model is especially well suited for machine learning tasks because of its ability to easily incorporate data sources of different spatial resolutions, projections and data types together By giving additional information to the classifier, it is able to separate different classes easily. Here we take the same example and augment it with the following techniques</p>
<ul>
<li><em>Apply Cloud Masking</em></li>
<li><em>Add Spectral Indices</em>: We add bands for different spectral indices such as - NDVI, NDBI, MNDWI and BSI.</li>
<li><em>Add Elevation and Slope</em>: We also add slope and elevation bands from the ALOS DEM.</li>
<li><em>Normalize the Inputs</em>: Machine learning models work best when all the inputs have the same scale. We will divide each band with the maximum value. This method ensures that all input values are between 0-1. A more <a href="https://courses.spatialthoughts.com/#image-normalization-and-standardization">complete and robust technique</a> for image normalization is provided in the course Supplement.</li>
</ul>
<p>Our training features have more parameters and contain values of the same scale. The result is a much improved classification.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/improving_classification.png" alt="Improved Classification Accuracy with use of Spectral Indices and Elevation Data"></p>
<p>Improved Classification Accuracy with use of Spectral Indices and Elevation Data</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F03b_Improving_the_Classification_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> basin <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> alos <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> arkavathy <span style="color:#f92672">=</span> basin<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;HYBAS_ID&#39;</span>, <span style="color:#ae81ff">4071139640</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> arkavathy<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addIndices <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndvi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndbi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B11&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndbi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mndwi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B11&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;mndwi&#39;</span>]); 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bsi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>expression(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B11&#39;</span>), <span style="color:#f92672">//</span>swir1
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Y&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B4&#39;</span>),  <span style="color:#f92672">//</span>red
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;A&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B8&#39;</span>), <span style="color:#f92672">//</span> nir
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;B&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B2&#39;</span>), <span style="color:#f92672">//</span> blue
</span></span><span style="display:flex;"><span>  })<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;bsi&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndvi)<span style="color:#f92672">.</span>addBands(ndbi)<span style="color:#f92672">.</span>addBands(mndwi)<span style="color:#f92672">.</span>addBands(bsi);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> addIndices(composite);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate Slope <span style="color:#f92672">and</span> Elevation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use ALOS <span style="color:#a6e22e">World</span> <span style="color:#ae81ff">3</span>D v3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This comes as a collection of images
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We mosaic it to create a single image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Need to set the projection correctly on the mosaic
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> the slope computation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> proj <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>projection();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> elevation <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;DSM&#39;</span>)<span style="color:#f92672">.</span>mosaic()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>setDefaultProjection(proj)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;elev&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> slope <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Terrain<span style="color:#f92672">.</span>slope(elevation)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;slope&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>addBands(elevation)<span style="color:#f92672">.</span>addBands(slope);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visParams <span style="color:#f92672">=</span> {bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3000</span>, gamma: <span style="color:#ae81ff">1.2</span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), visParams, <span style="color:#e6db74">&#39;RGB&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Normalize the image 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Machine learning algorithms work best on images when all features have
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the same range
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to Normalize <span style="color:#a6e22e">Image</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Pixel Values should be between <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Formula is (x <span style="color:#f92672">-</span> xmin) <span style="color:#f92672">/</span> (xmax <span style="color:#f92672">-</span> xmin)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>function normalize(image){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bandNames <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> Compute min <span style="color:#f92672">and</span> max of the image
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> minDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>min(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>max(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mins <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(minDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxs <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(maxDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> normalized <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>subtract(mins)<span style="color:#f92672">.</span>divide(maxs<span style="color:#f92672">.</span>subtract(mins));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> normalized;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> normalize(composite);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a random column <span style="color:#f92672">and</span> split the GCPs into training <span style="color:#f92672">and</span> validation set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>randomColumn();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This being a simpler classification, we take <span style="color:#ae81ff">60</span><span style="color:#f92672">%</span> points
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> validation<span style="color:#f92672">.</span> Normal recommended ratio is
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">70</span><span style="color:#f92672">%</span> training, <span style="color:#ae81ff">30</span><span style="color:#f92672">%</span> validation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> trainingGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validationGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>gte(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: trainingGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>print(training);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>,
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Accuracy Assessment
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use classification map to assess accuracy using the validation fraction
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> of the overall training set created above<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> test <span style="color:#f92672">=</span> classified<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: validationGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> testConfusionMatrix <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>errorMatrix(<span style="color:#e6db74">&#39;landcover&#39;</span>, <span style="color:#e6db74">&#39;classification&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Printing of confusion matrix may time out<span style="color:#f92672">.</span> Alternatively, you can <span style="color:#66d9ef">export</span> it as CSV
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Confusion Matrix&#39;</span>, testConfusionMatrix);
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Test Accuracy&#39;</span>, testConfusionMatrix<span style="color:#f92672">.</span>accuracy());
</span></span></code></pre></div><h3 id="exercise-10">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F03c_Improving_the_Classification_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Improve your classification from Exercise <span style="color:#ae81ff">01</span>c 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add different spectral indicies to your composite
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> by using the function below
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addIndices <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndvi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndbi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B11&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndbi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mndwi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B11&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;mndwi&#39;</span>]); 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bsi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>expression(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B11&#39;</span>), <span style="color:#f92672">//</span>swir1
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Y&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B4&#39;</span>),  <span style="color:#f92672">//</span>red
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;A&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B8&#39;</span>), <span style="color:#f92672">//</span> nir
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;B&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B2&#39;</span>), <span style="color:#f92672">//</span> blue
</span></span><span style="display:flex;"><span>  })<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;bsi&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndvi)<span style="color:#f92672">.</span>addBands(ndbi)<span style="color:#f92672">.</span>addBands(mndwi)<span style="color:#f92672">.</span>addBands(bsi);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div><h2 id="04-exporting-classification-results">04. Exporting Classification Results</h2>
<p>When working with complex classifiers over large regions, you may get a <em>User memory limit exceeded</em> or <em>Computation timed out</em> error in the Code Editor. The reason for this is that there is a fixed time limit and smaller memory allocated for code that is run with the <em>On-Demand Computation</em> mode. For larger computations, you can use the <em>Batch</em> mode with the <code>Export</code> functions. Exports run in the background and can run longer than 5-minutes time allocated to the computation code run from the Code Editor. This allows you to process very large and complex datasets. Here’s an example showing how to export your classification results to Google Drive.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/export_classification.png" alt="Exported Classification Outputs"></p>
<p>Exported Classification Outputs</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F04b_Exporting_Classification_Results_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> basin <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> alos <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> arkavathy <span style="color:#f92672">=</span> basin<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;HYBAS_ID&#39;</span>, <span style="color:#ae81ff">4071139640</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> arkavathy<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addIndices <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndvi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndbi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B11&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndbi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mndwi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B11&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;mndwi&#39;</span>]); 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bsi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>expression(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B11&#39;</span>), <span style="color:#f92672">//</span>swir1
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Y&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B4&#39;</span>),  <span style="color:#f92672">//</span>red
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;A&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B8&#39;</span>), <span style="color:#f92672">//</span> nir
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;B&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B2&#39;</span>), <span style="color:#f92672">//</span> blue
</span></span><span style="display:flex;"><span>  })<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;bsi&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndvi)<span style="color:#f92672">.</span>addBands(ndbi)<span style="color:#f92672">.</span>addBands(mndwi)<span style="color:#f92672">.</span>addBands(bsi);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> addIndices(composite);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate Slope <span style="color:#f92672">and</span> Elevation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use ALOS <span style="color:#a6e22e">World</span> <span style="color:#ae81ff">3</span>D v3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This comes as a collection of images
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We mosaic it to create a single image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Need to set the projection correctly on the mosaic
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> the slope computation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> proj <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>projection();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> elevation <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;DSM&#39;</span>)<span style="color:#f92672">.</span>mosaic()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>setDefaultProjection(proj)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;elev&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> slope <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Terrain<span style="color:#f92672">.</span>slope(elevation)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;slope&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>addBands(elevation)<span style="color:#f92672">.</span>addBands(slope);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visParams <span style="color:#f92672">=</span> {bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3000</span>, gamma: <span style="color:#ae81ff">1.2</span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), visParams, <span style="color:#e6db74">&#39;RGB&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Normalize the image 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Machine learning algorithms work best on images when all features have
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the same range
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to Normalize <span style="color:#a6e22e">Image</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Pixel Values should be between <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Formula is (x <span style="color:#f92672">-</span> xmin) <span style="color:#f92672">/</span> (xmax <span style="color:#f92672">-</span> xmin)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>function normalize(image){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bandNames <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> Compute min <span style="color:#f92672">and</span> max of the image
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> minDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>min(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>max(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mins <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(minDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxs <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(maxDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> normalized <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>subtract(mins)<span style="color:#f92672">.</span>divide(maxs<span style="color:#f92672">.</span>subtract(mins));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> normalized;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> normalize(composite);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a random column <span style="color:#f92672">and</span> split the GCPs into training <span style="color:#f92672">and</span> validation set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>randomColumn();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This being a simpler classification, we take <span style="color:#ae81ff">60</span><span style="color:#f92672">%</span> points
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> validation<span style="color:#f92672">.</span> Normal recommended ratio is
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">70</span><span style="color:#f92672">%</span> training, <span style="color:#ae81ff">30</span><span style="color:#f92672">%</span> validation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> trainingGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validationGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>gte(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: trainingGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>print(training);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>,
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Accuracy Assessment
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use classification map to assess accuracy using the validation fraction
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> of the overall training set created above<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> test <span style="color:#f92672">=</span> classified<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: validationGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> testConfusionMatrix <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>errorMatrix(<span style="color:#e6db74">&#39;landcover&#39;</span>, <span style="color:#e6db74">&#39;classification&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exporting Results
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export the classified image to Drive
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> For images having integers (such as <span style="color:#66d9ef">class</span> numbers)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> we cast the image to floating point data type which
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> allows the masked values to be saved as NaN values
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">in</span> the GeoTIFF format<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can set these to actual NoData values using
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> GDAL tools after the <span style="color:#66d9ef">export</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> gdal_translate <span style="color:#f92672">-</span>a_nodata <span style="color:#e6db74">&#39;nan&#39;</span> input<span style="color:#f92672">.</span>tif output<span style="color:#f92672">.</span>tif
</span></span><span style="display:flex;"><span>Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toDrive({
</span></span><span style="display:flex;"><span>  image: classified<span style="color:#f92672">.</span>clip(geometry)<span style="color:#f92672">.</span>toFloat(),
</span></span><span style="display:flex;"><span>  description: <span style="color:#e6db74">&#39;Classified_Image_Export&#39;</span>,
</span></span><span style="display:flex;"><span>  folder: <span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>  fileNamePrefix: <span style="color:#e6db74">&#39;classified&#39;</span>,
</span></span><span style="display:flex;"><span>  region: geometry,
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  maxPixels: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Export the results of accuracy asssessment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a Feature with null geometry <span style="color:#f92672">and</span> the value we want to <span style="color:#66d9ef">export</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use <span style="color:#f92672">.</span>array() to convert Confusion Matrix to an <span style="color:#a6e22e">Array</span> so it can be
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> exported <span style="color:#f92672">in</span> a CSV file
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> fc <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection([
</span></span><span style="display:flex;"><span>  ee<span style="color:#f92672">.</span>Feature(null, {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;accuracy&#39;</span>: testConfusionMatrix<span style="color:#f92672">.</span>accuracy(),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;matrix&#39;</span>: testConfusionMatrix<span style="color:#f92672">.</span>array()
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(fc);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Export<span style="color:#f92672">.</span>table<span style="color:#f92672">.</span>toDrive({
</span></span><span style="display:flex;"><span>  collection: fc,
</span></span><span style="display:flex;"><span>  description: <span style="color:#e6db74">&#39;Accuracy_Assessment_Export&#39;</span>,
</span></span><span style="display:flex;"><span>  folder: <span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>  fileNamePrefix: <span style="color:#e6db74">&#39;accuracy&#39;</span>,
</span></span><span style="display:flex;"><span>  fileFormat: <span style="color:#e6db74">&#39;CSV&#39;</span>
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="exercise-11">Exercise</h3>
<p>It is also a good idea to export the classified image as an Asset. This will allows you to import the classified image in another script without running the whole classification workflow. Use the Export.image.toAsset() function to export the classified image as an asset.</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F04c_Exporting_Classification_Results_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> basin <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;WWF/HydroSHEDS/v1/Basins/hybas_7&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/arkavathy_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> alos <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;JAXA/ALOS/AW3D30/V3_2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> arkavathy <span style="color:#f92672">=</span> basin<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;HYBAS_ID&#39;</span>, <span style="color:#ae81ff">4071139640</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> arkavathy<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addIndices <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndvi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndbi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B11&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndbi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mndwi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B11&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;mndwi&#39;</span>]); 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bsi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>expression(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;(( X + Y ) - (A + B)) /(( X + Y ) + (A + B)) &#39;</span>, {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;X&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B11&#39;</span>), <span style="color:#f92672">//</span>swir1
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;Y&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B4&#39;</span>),  <span style="color:#f92672">//</span>red
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;A&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B8&#39;</span>), <span style="color:#f92672">//</span> nir
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;B&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B2&#39;</span>), <span style="color:#f92672">//</span> blue
</span></span><span style="display:flex;"><span>  })<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;bsi&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndvi)<span style="color:#f92672">.</span>addBands(ndbi)<span style="color:#f92672">.</span>addBands(mndwi)<span style="color:#f92672">.</span>addBands(bsi);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> addIndices(composite);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate Slope <span style="color:#f92672">and</span> Elevation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use ALOS <span style="color:#a6e22e">World</span> <span style="color:#ae81ff">3</span>D v3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This comes as a collection of images
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We mosaic it to create a single image
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Need to set the projection correctly on the mosaic
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> the slope computation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> proj <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>projection();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> elevation <span style="color:#f92672">=</span> alos<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;DSM&#39;</span>)<span style="color:#f92672">.</span>mosaic()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>setDefaultProjection(proj)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;elev&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> slope <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Terrain<span style="color:#f92672">.</span>slope(elevation)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;slope&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>addBands(elevation)<span style="color:#f92672">.</span>addBands(slope);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visParams <span style="color:#f92672">=</span> {bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3000</span>, gamma: <span style="color:#ae81ff">1.2</span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), visParams, <span style="color:#e6db74">&#39;RGB&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Normalize the image 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Machine learning algorithms work best on images when all features have
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the same range
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to Normalize <span style="color:#a6e22e">Image</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Pixel Values should be between <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Formula is (x <span style="color:#f92672">-</span> xmin) <span style="color:#f92672">/</span> (xmax <span style="color:#f92672">-</span> xmin)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//**************************************************************************</span> 
</span></span><span style="display:flex;"><span>function normalize(image){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> bandNames <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> Compute min <span style="color:#f92672">and</span> max of the image
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> minDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>min(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxDict <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>max(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e9</span>,
</span></span><span style="display:flex;"><span>    bestEffort: true,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mins <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(minDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> maxs <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>constant(maxDict<span style="color:#f92672">.</span>values(bandNames));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> normalized <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>subtract(mins)<span style="color:#f92672">.</span>divide(maxs<span style="color:#f92672">.</span>subtract(mins));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> normalized;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> normalize(composite);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a random column <span style="color:#f92672">and</span> split the GCPs into training <span style="color:#f92672">and</span> validation set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> gcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>randomColumn();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This being a simpler classification, we take <span style="color:#ae81ff">60</span><span style="color:#f92672">%</span> points
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> validation<span style="color:#f92672">.</span> Normal recommended ratio is
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">70</span><span style="color:#f92672">%</span> training, <span style="color:#ae81ff">30</span><span style="color:#f92672">%</span> validation
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> trainingGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> validationGcp <span style="color:#f92672">=</span> gcp<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>gte(<span style="color:#e6db74">&#39;random&#39;</span>, <span style="color:#ae81ff">0.6</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: trainingGcp,
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>],
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>,
</span></span><span style="display:flex;"><span>  inputProperties: composite<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toAsset() function to <span style="color:#66d9ef">export</span> the 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> classified image as a Earth Engine Asset<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This will allows you to import the classified image <span style="color:#f92672">in</span> another
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> script without running the whole classification workflow<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: For images with discrete pixel values, we must set the
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> pyramidingPolicy to <span style="color:#e6db74">&#39;mode&#39;</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The pyramidingPolicy parameter should a dictionary specifying
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the policy <span style="color:#66d9ef">for</span> each band<span style="color:#f92672">.</span> A simpler way to specify it <span style="color:#66d9ef">for</span> all
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> bands is to use {<span style="color:#e6db74">&#39;.default&#39;</span>: <span style="color:#e6db74">&#39;mode&#39;</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> assetId should be specified as a string
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> It can be just the asset name <span style="color:#e6db74">&#39;classified_image&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">or</span> a full path such as <span style="color:#e6db74">&#39;projects/ee-&lt;yourusername&gt;/classified_image&#39;</span>
</span></span></code></pre></div><h2 id="05-calculating-area">05. Calculating Area</h2>
<p>Now that we have the results of our classification, we will learn how to calculate the area for pixels in each class. The functions used for area computations are different for vectors and raster data.</p>
<ul>
<li><strong>Area of Polygons</strong>: Calculating area for polygons is done using the <code>area()</code> function. It computes area on a sphere (ignoring the ellipsoid flattening) and gives you the area in square meters. You can optionally supply <code>proj</code> and a non-zero <code>maxError</code> parameters to calculate area in a specific projected CRS. For example, <code>area({proj:'EPSG:32643', maxError: 1})</code> will calculate the area of the polygon after reprojecting it to the <em>WGS 84/UTM Zone 43</em> CRS with a tolerance of 1 meter.</li>
<li><strong>Area of Image Pixels</strong>: Area of image pixels is computed using the <code>ee.Image.pixelArea()</code> function. This function computes the area inside the 4 corners of each pixel using the WGS84 ellipsoid. The <code>ee.Image.pixelArea()</code> function uses a custom equal-area projection for area calculation. The result is area in square meters regardless of the projection of the input image. <a href="https://groups.google.com/g/google-earth-engine-developers/c/Ccaorx-obVw/m/_ZQdP2wVAgAJ">Learn more</a>.</li>
</ul>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/area_calculation.png" alt="Calculating Green Cover from Classified Image"></p>
<p>Calculating Green Cover from Classified Image</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F05b_Calculating_Area_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/bangalore_classified&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bangalore <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(bangalore, {color: <span style="color:#e6db74">&#39;blue&#39;</span>}, <span style="color:#e6db74">&#39;Bangalore City&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified, {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette}, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calling <span style="color:#f92672">.</span>geometry() on a feature collection gives the
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> dissolved geometry of all features <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">.</span>area() function calculates the area <span style="color:#f92672">in</span> square meters
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> cityArea <span style="color:#f92672">=</span> bangalore<span style="color:#f92672">.</span>geometry()<span style="color:#f92672">.</span>area();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We can cast the result to a ee<span style="color:#f92672">.</span>Number() <span style="color:#f92672">and</span> calculate the
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> area <span style="color:#f92672">in</span> square kilometers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> cityAreaSqKm <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Number(cityArea)<span style="color:#f92672">.</span>divide(<span style="color:#ae81ff">1e6</span>)<span style="color:#f92672">.</span>round();
</span></span><span style="display:flex;"><span>print(cityAreaSqKm);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#a6e22e">Area</span> Calculation <span style="color:#66d9ef">for</span> Images
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> vegetation <span style="color:#f92672">=</span> classified<span style="color:#f92672">.</span>eq(<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> If the image contains values <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">1</span>, we can calculate the
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> total area using reduceRegion() function
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The result of <span style="color:#f92672">.</span>eq() operation is a binary image with pixels
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> values of <span style="color:#ae81ff">1</span> where the condition matched <span style="color:#f92672">and</span> <span style="color:#ae81ff">0</span> where it didn<span style="color:#e6db74">&#39;t</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(vegetation, {min:<span style="color:#ae81ff">0</span>, max:<span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;green&#39;</span>]}, <span style="color:#e6db74">&#39;Green Cover&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Since our image has only <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">1</span> pixel values, the vegetation
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> pixels will have values equal to their area
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> areaImage <span style="color:#f92672">=</span> vegetation<span style="color:#f92672">.</span>multiply(ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>pixelArea());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Now that each pixel <span style="color:#66d9ef">for</span> vegetation <span style="color:#66d9ef">class</span> <span style="color:#f92672">in</span> the image has the value
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> equal to its area, we can sum up all the values <span style="color:#f92672">in</span> the region
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> to get the total green cover<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> area <span style="color:#f92672">=</span> areaImage<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>  reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>sum(),
</span></span><span style="display:flex;"><span>  geometry: bangalore<span style="color:#f92672">.</span>geometry(),
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  maxPixels: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The result of the reduceRegion() function is a dictionary with the key
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> being the band name<span style="color:#f92672">.</span> We can extract the area number <span style="color:#f92672">and</span> convert it to
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> square kilometers
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> vegetationAreaSqKm <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Number(area<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;classification&#39;</span>))<span style="color:#f92672">.</span>divide(<span style="color:#ae81ff">1e6</span>)<span style="color:#f92672">.</span>round();
</span></span><span style="display:flex;"><span>print(vegetationAreaSqKm);
</span></span></code></pre></div><blockquote>
<p>If you want to compute area covered by each class, you can use a <a href="https://developers.google.com/earth-engine/reducers_grouping">Grouped Reducer</a>. See the <a href="https://courses.spatialthoughts.com/end-to-end-gee-supplement.html#calculating-area-by-class">Supplement</a> to see a code snippet.</p>
</blockquote>
<h3 id="exercise-12">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A03-Supervised-Classification%2F05c_Calculating_Area_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Exercise
</span></span><span style="display:flex;"><span>// Compute and print the percentage green cover of the city
</span></span></code></pre></div><h2 id="assignment-3">Assignment 3</h2>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3AAssignments%2FAssignment3">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Choose a city of your choice and create land use land classification
</span></span><span style="display:flex;"><span>// using supervised classification technique. 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// You can use your script 01c from 03-Supervised-Classification
</span></span><span style="display:flex;"><span>// module as a starting point.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// The classification should incorporate the following techniques
</span></span><span style="display:flex;"><span>// 1. Add relevant indicies
</span></span><span style="display:flex;"><span>// 2. Add cloud masking
</span></span><span style="display:flex;"><span>// 3. Add elevation and slope
</span></span><span style="display:flex;"><span>// 4. Normalize the data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// [Optional]
</span></span><span style="display:flex;"><span>// Accuracy Assessment
</span></span><span style="display:flex;"><span>// Post-processing Classification
</span></span></code></pre></div><h2 id="module-4-change-detection">Module 4: Change Detection</h2>
<h2 id="introduction-to-change-detection">Introduction to Change Detection</h2>
<p>Many earth observation datasets are available at regular intervals over long periods of time. This enables us to detect changes on the Earth’s surface. Change detection technique in remote sensing fall in the following categories</p>
<ul>
<li><strong>Single Band Change</strong>: Measuring change in a single band image or a spectral index using a threshold</li>
<li><strong>Multi Band Change</strong>: Measuring spectral distance and spectral angle between two multiband images</li>
<li><strong>Classification of Change</strong>: One-pass classification using stacked image containing bands from before and after an event</li>
<li><strong>Post Classification Comparison</strong>: Comparing two classified images and computing class transitions</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=ybHxiygVVz0&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=5"><img src="https://img.youtube.com/vi/ybHxiygVVz0/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=ybHxiygVVz0&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=5">Watch the Video ↗</a></p>
<h2 id="01-spectral-index-change">01. Spectral Index Change</h2>
<p>Many types of change can be detected by measuring the change in a spectral index and applying a threshold. This technique is suitable when there is a suitable spectral index is available for the type of change you are interested in detecting.</p>
<p>Here we apply this technique to map the extent and severity of a forest fire. The <strong>Normalized Burn Ratio (NBR)</strong> is an index that is designed to highlight burnt vegetation areas. We compute the NBR for before and after images. Then we apply a suitable threshold to find burnt areas.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/spectral_index_change.png" alt="Spectral Index Change Detection"></p>
<p>Spectral Index Change Detection</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01b_Spectral_Index_Change_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> On <span style="color:#ae81ff">21</span>st February <span style="color:#ae81ff">2019</span>, massive forest fires broke out <span style="color:#f92672">in</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> numerous places across the Bandipur National Park of
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> the Karnataka state <span style="color:#f92672">in</span> India<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> By <span style="color:#ae81ff">25</span> February <span style="color:#ae81ff">2019</span> most fire was brought under control
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This script shows how to <span style="color:#66d9ef">do</span> damage assessment using
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> spectral index change detection technique<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Define the area of interest
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Polygon([[
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.37639666685044</span>, <span style="color:#ae81ff">11.766523239445169</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.37639666685044</span>, <span style="color:#ae81ff">11.519036946599561</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.78426409849106</span>, <span style="color:#ae81ff">11.519036946599561</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.78426409849106</span>, <span style="color:#ae81ff">11.766523239445169</span>]
</span></span><span style="display:flex;"><span>]]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> fireStart <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2019-02-20&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> fireEnd <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2019-02-25&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;COPERNICUS/S2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply filters 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create Before <span style="color:#f92672">and</span> After composites
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> before <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    fireStart<span style="color:#f92672">.</span>advance(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;month&#39;</span>), fireStart))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> after <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    fireEnd, fireEnd<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Freshly burnt regions appeat bright <span style="color:#f92672">in</span> SWIR<span style="color:#f92672">-</span>bands
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use a False <span style="color:#a6e22e">Color</span> Visualization
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> swirVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B12&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(before<span style="color:#f92672">.</span>clip(geometry), swirVis, <span style="color:#e6db74">&#39;Before&#39;</span>)
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(after<span style="color:#f92672">.</span>clip(geometry), swirVis, <span style="color:#e6db74">&#39;After&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Write a function to calculate  Normalized Burn Ratio (NBR)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#e6db74">&#39;NIR&#39;</span> (B8) <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;SWIR-2&#39;</span> (B12)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addNBR <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> nbr <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B12&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;nbr&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(nbr)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> beforeNbr <span style="color:#f92672">=</span> addNBR(before)<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;nbr&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> afterNbr <span style="color:#f92672">=</span> addNBR(after)<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;nbr&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> nbrVis <span style="color:#f92672">=</span> {min: <span style="color:#f92672">-</span><span style="color:#ae81ff">0.5</span>, max: <span style="color:#ae81ff">0.5</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;black&#39;</span>]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(beforeNbr<span style="color:#f92672">.</span>clip(geometry), nbrVis, <span style="color:#e6db74">&#39;Prefire NBR&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(afterNbr<span style="color:#f92672">.</span>clip(geometry), nbrVis, <span style="color:#e6db74">&#39;Postfire NBR&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate Change <span style="color:#f92672">in</span> NBR (dNBR)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> change <span style="color:#f92672">=</span> beforeNbr<span style="color:#f92672">.</span>subtract(afterNbr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply a threshold
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display Burned Areas
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> burned <span style="color:#f92672">=</span> change<span style="color:#f92672">.</span>gt(threshold)
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(burned<span style="color:#f92672">.</span>clip(geometry), {min:<span style="color:#ae81ff">0</span>, max:<span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]}, <span style="color:#e6db74">&#39;Burned&#39;</span>, false) 
</span></span></code></pre></div><h3 id="exercise-13">Exercise</h3>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/spectral_index_change_exercise.png" alt="Classifying the Change Image"></p>
<p>Classifying the Change Image</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01c_Spectral_Index_Change_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Define the area of interest
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Polygon([[
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.37639666685044</span>, <span style="color:#ae81ff">11.766523239445169</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.37639666685044</span>, <span style="color:#ae81ff">11.519036946599561</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.78426409849106</span>, <span style="color:#ae81ff">11.519036946599561</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">76.78426409849106</span>, <span style="color:#ae81ff">11.766523239445169</span>]
</span></span><span style="display:flex;"><span>]]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> fireStart <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2019-02-20&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> fireEnd <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2019-02-25&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;COPERNICUS/S2&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply filters 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create Before <span style="color:#f92672">and</span> After composites
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> before <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    fireStart<span style="color:#f92672">.</span>advance(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;month&#39;</span>), fireStart))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> after <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    fireEnd, fireEnd<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Write a function to calculate  Normalized Burn Ratio (NBR)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#e6db74">&#39;NIR&#39;</span> (B8) <span style="color:#f92672">and</span> <span style="color:#e6db74">&#39;SWIR-2&#39;</span> (B12)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addNBR <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> nbr <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B12&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;nbr&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(nbr)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> beforeNbr <span style="color:#f92672">=</span> addNBR(before)<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;nbr&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> afterNbr <span style="color:#f92672">=</span> addNBR(after)<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;nbr&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate Change <span style="color:#f92672">in</span> NBR (dNBR)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> change <span style="color:#f92672">=</span> beforeNbr<span style="color:#f92672">.</span>subtract(afterNbr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dnbrPalette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#ffffb2&#39;</span>,<span style="color:#e6db74">&#39;#fecc5c&#39;</span>,<span style="color:#e6db74">&#39;#fd8d3c&#39;</span>,<span style="color:#e6db74">&#39;#f03b20&#39;</span>,<span style="color:#e6db74">&#39;#bd0026&#39;</span>];
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the change image
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(change<span style="color:#f92672">.</span>clip(geometry), {min:<span style="color:#ae81ff">0.1</span>, max: <span style="color:#ae81ff">0.7</span>, palette: dnbrPalette},
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Change in NBR&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We can also classify the change image according to
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> burn severity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> United States Geological Survey (USGS) proposed
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> a classification table to interpret the burn severity
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We will assign a discrete <span style="color:#66d9ef">class</span> value <span style="color:#f92672">and</span> visualize it
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Severity     <span style="color:#f92672">|</span> dNBR <span style="color:#a6e22e">Range</span>         <span style="color:#f92672">|</span> Class <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|--------------|--------------------|-------|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Unburned     <span style="color:#f92672">|</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.1</span>              <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Low Severity <span style="color:#f92672">|</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.10</span> <span style="color:#f92672">and</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0.27</span>  <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Moderate<span style="color:#f92672">-</span>Low <span style="color:#f92672">|</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.27</span> <span style="color:#f92672">and</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0.44</span>  <span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Moderate<span style="color:#f92672">-</span>High<span style="color:#f92672">|</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.44</span> <span style="color:#f92672">and</span><span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.66</span>  <span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> High         <span style="color:#f92672">|</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0.66</span>            <span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classification of continuous values can be done
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> using the <span style="color:#f92672">.</span>where() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> severity <span style="color:#f92672">=</span> change
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>where(change<span style="color:#f92672">.</span>lt(<span style="color:#ae81ff">0.10</span>), <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>where(change<span style="color:#f92672">.</span>gte(<span style="color:#ae81ff">0.10</span>)<span style="color:#f92672">.</span><span style="color:#f92672">and</span>(change<span style="color:#f92672">.</span>lt(<span style="color:#ae81ff">0.27</span>)), <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>where(change<span style="color:#f92672">.</span>gte(<span style="color:#ae81ff">0.27</span>)<span style="color:#f92672">.</span><span style="color:#f92672">and</span>(change<span style="color:#f92672">.</span>lt(<span style="color:#ae81ff">0.44</span>)), <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>where(change<span style="color:#f92672">.</span>gte(<span style="color:#ae81ff">0.44</span>)<span style="color:#f92672">.</span><span style="color:#f92672">and</span>(change<span style="color:#f92672">.</span>lt(<span style="color:#ae81ff">0.66</span>)), <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>where(change<span style="color:#f92672">.</span>gt(<span style="color:#ae81ff">0.66</span>), <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The resulting image <span style="color:#e6db74">&#39;severity&#39;</span> is a discrete image with 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> pixel values from <span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">4</span> representing the severity <span style="color:#66d9ef">class</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the image according to the following color table
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Severity     <span style="color:#f92672">|</span> Class <span style="color:#f92672">|</span> <span style="color:#a6e22e">Color</span>   <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|--------------|-------|---------|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Unburned     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>     <span style="color:#f92672">|</span> green   <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Low Severity <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>     <span style="color:#f92672">|</span> yellow  <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Moderate<span style="color:#f92672">-</span>Low <span style="color:#f92672">|</span> <span style="color:#ae81ff">2</span>     <span style="color:#f92672">|</span> organge <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> Moderate<span style="color:#f92672">-</span>High<span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span>     <span style="color:#f92672">|</span> red     <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">|</span> High         <span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>     <span style="color:#f92672">|</span> magenta <span style="color:#f92672">|</span>
</span></span></code></pre></div><h2 id="02-spectral-distance-change">02. Spectral Distance Change</h2>
<p>When you want to detect changes from multi-band images, a useful technique is to compute the Spectral Distance and Spectral Angle between the two images. Pixels that exhibit a large change will have a larger distance compared to those that did not change. This technique is particularly useful when there are no suitable index to detect the change. It can be applied to detect change after natural disasters or human conflicts.</p>
<p>Here we use this technique to detect landslides using before/after composites. You may learn more about this technique at <a href="https://goo.gl/xotYhk">Craig D’Souza’s Change Detection</a> presentation.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/spectral_distance.png" alt="Spectral Distance Change Detection"></p>
<p>Spectral Distance Change Detection</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01b_Spectral_Distance_Change_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Polygon([[
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.70357667713435</span>, <span style="color:#ae81ff">12.49723970868507</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.70357667713435</span>, <span style="color:#ae81ff">12.470171844429931</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.7528434923199</span>, <span style="color:#ae81ff">12.470171844429931</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.7528434923199</span>, <span style="color:#ae81ff">12.49723970868507</span>]
</span></span><span style="display:flex;"><span>]]);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.65</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dateOfIncident <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2018-08-15&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> before <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(dateOfIncident<span style="color:#f92672">.</span>advance(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;year&#39;</span>), dateOfIncident))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>calendarRange(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;month&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> after <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    dateOfIncident, dateOfIncident<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(before<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;Before&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(after<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;After&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the spectralDistance() function to get spectral distance measures
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the metric <span style="color:#e6db74">&#39;Spectral Angle Mapper (SAM)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The result is the spectral angle <span style="color:#f92672">in</span> radians
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> angle <span style="color:#f92672">=</span> after<span style="color:#f92672">.</span>spectralDistance(before, <span style="color:#e6db74">&#39;sam&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(angle<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;purple&#39;</span>]}, <span style="color:#e6db74">&#39;Spectral Angle&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the metric <span style="color:#e6db74">&#39;Squared Euclidian Distance (SED)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> sed <span style="color:#f92672">=</span> after<span style="color:#f92672">.</span>spectralDistance(before, <span style="color:#e6db74">&#39;sed&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Take square root to get euclidian distance
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> distance <span style="color:#f92672">=</span> sed<span style="color:#f92672">.</span>sqrt();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(distance<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">1500</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]}, <span style="color:#e6db74">&#39;spectral distance&#39;</span>);
</span></span></code></pre></div><h3 id="exercise-14">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F01c_Spectral_Distance_Change_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Polygon([[
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.70357667713435</span>, <span style="color:#ae81ff">12.49723970868507</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.70357667713435</span>, <span style="color:#ae81ff">12.470171844429931</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.7528434923199</span>, <span style="color:#ae81ff">12.470171844429931</span>],
</span></span><span style="display:flex;"><span>  [<span style="color:#ae81ff">75.7528434923199</span>, <span style="color:#ae81ff">12.49723970868507</span>]
</span></span><span style="display:flex;"><span>]]);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.65</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dateOfIncident <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2018-08-15&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> before <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(dateOfIncident<span style="color:#f92672">.</span>advance(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;year&#39;</span>), dateOfIncident))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>calendarRange(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;month&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> after <span style="color:#f92672">=</span> filteredMasked
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(
</span></span><span style="display:flex;"><span>    dateOfIncident, dateOfIncident<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>)))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median()
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(before<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;Before&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(after<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;After&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the spectralDistance() function to get spectral distance measures
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the metric <span style="color:#e6db74">&#39;Spectral Angle Mapper (SAM)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The result is the spectral angle <span style="color:#f92672">in</span> radians
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> angle <span style="color:#f92672">=</span> after<span style="color:#f92672">.</span>spectralDistance(before, <span style="color:#e6db74">&#39;sam&#39;</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(angle<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;purple&#39;</span>]}, <span style="color:#e6db74">&#39;Spectral Angle&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Inspect the angle image <span style="color:#f92672">and</span> find a suitable threshold
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> that signifies damage after the landslides
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Apply the threshold <span style="color:#f92672">and</span> create a new image showing landslides
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the results
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: Use the <span style="color:#f92672">.</span>gt() method to apply the threshold
</span></span></code></pre></div><h2 id="03-direct-classification-of-change">03. Direct Classification of Change</h2>
<p>This technique of change detection is also known as <em>One-pass Classification</em> or <em>Direct Multi-date Classification</em>. Here we create a single stacked image containing bands from before and after images. We train a classifier with training data sampled from the stacked image and apply the classifier on the stacked image to find all change pixels.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/change_classification.png" alt="All pixels that changed from bare ground to built-up"></p>
<p>All pixels that changed from bare ground to built-up</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F03b_Classifying_Change_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bangalore <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> change <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/bangalore_change_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> nochange <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/bangalore_nochange_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> bangalore<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>],
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Write a function <span style="color:#66d9ef">for</span> Cloud masking
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> January <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered2019 <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>,<span style="color:#e6db74">&#39;2019-02-01&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> image2019 <span style="color:#f92672">=</span> filtered2019<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(image2019<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;2019&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> January <span style="color:#ae81ff">2020</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered2020 <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>,<span style="color:#e6db74">&#39;2020-02-01&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> image2020 <span style="color:#f92672">=</span> filtered2020<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(image2020<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;2020&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> stackedImage <span style="color:#f92672">=</span> image2019<span style="color:#f92672">.</span>addBands(image2020);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> stackedImage<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: change<span style="color:#f92672">.</span>merge(nochange), 
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;class&#39;</span>], 
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;class&#39;</span>, 
</span></span><span style="display:flex;"><span>  inputProperties: stackedImage<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classified <span style="color:#f92672">=</span> stackedImage<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(classified<span style="color:#f92672">.</span>clip(geometry), {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]}, <span style="color:#e6db74">&#39;change&#39;</span>); 
</span></span></code></pre></div><h3 id="exercise-15">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?accept_repo=users%2Fujavalgandhi%2FEnd-to-End-GEE&amp;scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F03c_Classifying_Change_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Add an NDBI band to improve the detection of changes<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> addNDBI <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndbi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B11&#39;</span>, <span style="color:#e6db74">&#39;B8&#39;</span>])<span style="color:#f92672">.</span>rename([<span style="color:#e6db74">&#39;ndbi&#39;</span>]);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndbi)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> use addNDBI() function to add the NDBI band to both <span style="color:#ae81ff">2019</span> <span style="color:#f92672">and</span> <span style="color:#ae81ff">2020</span> composite images
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint1: You can save the resulting image <span style="color:#f92672">in</span> the same variable to avoid changing 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> a lot of code<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> addNDBI(image)
</span></span></code></pre></div><h2 id="04-post-classification-comparison">04. Post-classification Comparison</h2>
<p>We dealing with multi-class images, a useful metric for change detection is to know how many pixels from class X changed to class Y. This can be accomplished using the <code>ee.Reducer.frequencyHistogram()</code> reducer as shown below.</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F04b_Post_Classification_Comparison_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bangalore <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/public/bangalore_boundary&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> urban <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/urban_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> bare <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/bare_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> water <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/water_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> vegetation <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;users/ujavalgandhi/e2e/vegetation_gcps&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_SR&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> bangalore<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  min: <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>  max: <span style="color:#ae81ff">3000</span>,
</span></span><span style="display:flex;"><span>  bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>], 
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">2019</span> Jan
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2019-02-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> before <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median()<span style="color:#f92672">.</span>clip(geometry);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Display the input composite<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(before<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;before&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> urban<span style="color:#f92672">.</span>merge(bare)<span style="color:#f92672">.</span>merge(water)<span style="color:#f92672">.</span>merge(vegetation);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Overlay the point on the image to get training data<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> training <span style="color:#f92672">=</span> before<span style="color:#f92672">.</span>sampleRegions({
</span></span><span style="display:flex;"><span>  collection: training, 
</span></span><span style="display:flex;"><span>  properties: [<span style="color:#e6db74">&#39;landcover&#39;</span>], 
</span></span><span style="display:flex;"><span>  scale: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Train a classifier<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifier <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Classifier<span style="color:#f92672">.</span>smileRandomForest(<span style="color:#ae81ff">50</span>)<span style="color:#f92672">.</span>train({
</span></span><span style="display:flex;"><span>  features: training,  
</span></span><span style="display:flex;"><span>  classProperty: <span style="color:#e6db74">&#39;landcover&#39;</span>, 
</span></span><span style="display:flex;"><span>  inputProperties: before<span style="color:#f92672">.</span>bandNames()
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> beforeClassified <span style="color:#f92672">=</span> before<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;#cc6d8f&#39;</span>, <span style="color:#e6db74">&#39;#ffc107&#39;</span>, <span style="color:#e6db74">&#39;#1e88e5&#39;</span>, <span style="color:#e6db74">&#39;#004d40&#39;</span> ];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classifiedVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0</span>, max: <span style="color:#ae81ff">3</span>, palette: palette};
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(beforeClassified<span style="color:#f92672">.</span>clip(geometry), classifiedVis, <span style="color:#e6db74">&#39;before_classified&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#ae81ff">2020</span> Jan
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> after <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-02-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;B.*&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(after<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;after&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classify the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> afterClassified<span style="color:#f92672">=</span> after<span style="color:#f92672">.</span>classify(classifier);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(afterClassified<span style="color:#f92672">.</span>clip(geometry), classifiedVis, <span style="color:#e6db74">&#39;after_classified&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Reclassify from <span style="color:#ae81ff">0</span><span style="color:#f92672">-</span><span style="color:#ae81ff">3</span> to <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> beforeClasses <span style="color:#f92672">=</span> beforeClassified<span style="color:#f92672">.</span>remap([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> afterClasses <span style="color:#f92672">=</span> afterClassified<span style="color:#f92672">.</span>remap([<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Show all changed areas
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> changed <span style="color:#f92672">=</span> afterClasses<span style="color:#f92672">.</span>subtract(beforeClasses)<span style="color:#f92672">.</span>neq(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(changed<span style="color:#f92672">.</span>clip(geometry), {min:<span style="color:#ae81ff">0</span>, max:<span style="color:#ae81ff">1</span>, palette: [<span style="color:#e6db74">&#39;white&#39;</span>, <span style="color:#e6db74">&#39;red&#39;</span>]}, <span style="color:#e6db74">&#39;Change&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We multiply the before image with <span style="color:#ae81ff">100</span> <span style="color:#f92672">and</span> add the after image
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The resulting pixel values will be unique <span style="color:#f92672">and</span> will represent each unique transition
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> i<span style="color:#f92672">.</span>e<span style="color:#f92672">.</span> <span style="color:#ae81ff">102</span> is urban to bare, <span style="color:#ae81ff">103</span> urban to water etc<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> merged <span style="color:#f92672">=</span> beforeClasses<span style="color:#f92672">.</span>multiply(<span style="color:#ae81ff">100</span>)<span style="color:#f92672">.</span>add(afterClasses)<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;transitions&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use a frequencyHistogram to get a pixel count per <span style="color:#66d9ef">class</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> transitionMatrix <span style="color:#f92672">=</span> merged<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>  reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>frequencyHistogram(), 
</span></span><span style="display:flex;"><span>  geometry: geometry,
</span></span><span style="display:flex;"><span>  maxPixels: <span style="color:#ae81ff">1e10</span>,
</span></span><span style="display:flex;"><span>  scale:<span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>  tileScale: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This prints number of pixels <span style="color:#66d9ef">for</span> each <span style="color:#66d9ef">class</span> transition
</span></span><span style="display:flex;"><span>print(transitionMatrix<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;transitions&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> If we want to calculate the area of each <span style="color:#66d9ef">class</span> transition
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> we can use a grouped reducer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Divide by <span style="color:#ae81ff">1e6</span> to get the area <span style="color:#f92672">in</span> sq<span style="color:#f92672">.</span>km<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> areaImage <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image<span style="color:#f92672">.</span>pixelArea()<span style="color:#f92672">.</span>divide(<span style="color:#ae81ff">1e6</span>)<span style="color:#f92672">.</span>addBands(merged);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Calculate <span style="color:#a6e22e">Area</span> by each Transition Class
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> using a Grouped Reducer
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> areas <span style="color:#f92672">=</span> areaImage<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>      reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>group({
</span></span><span style="display:flex;"><span>      groupField: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      groupName: <span style="color:#e6db74">&#39;transitions&#39;</span>,
</span></span><span style="display:flex;"><span>    }),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>    tileScale: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>    }); 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Post<span style="color:#f92672">-</span>process the result to generate a clean output
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classAreas <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List(areas<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;groups&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classAreaLists <span style="color:#f92672">=</span> classAreas<span style="color:#f92672">.</span>map(function(item) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> areaDict <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Dictionary(item);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> classNumber <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Number(areaDict<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;transitions&#39;</span>))<span style="color:#f92672">.</span>format();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> area <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Number(areaDict<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;sum&#39;</span>))<span style="color:#f92672">.</span>round();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>List([classNumber, area]);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classTransitionsAreaDict <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Dictionary(classAreaLists<span style="color:#f92672">.</span>flatten());
</span></span><span style="display:flex;"><span>print(classTransitionsAreaDict);
</span></span></code></pre></div><h3 id="exercise-16">Exercise</h3>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/post_classification.png" alt="Lost water pixels between 2019 and 2020"></p>
<p>Lost water pixels between 2019 and 2020</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A04-Change-Detection%2F04c_Post_Classification_Comparison_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// Exercise
</span></span><span style="display:flex;"><span>// Show all areas where water became other classes and display the result
</span></span><span style="display:flex;"><span>// Hint1: Select class 3 pixels from before image and NOT class 3 pixels from after image
</span></span><span style="display:flex;"><span>// Hint2: use the .and() operation to select pixels matching both conditions
</span></span></code></pre></div><h2 id="module-5-earth-engine-apps">Module 5: Earth Engine Apps</h2>
<p>This module is focused the concepts related to client vs. server that will help you in creating web apps. We will be building an app using the Earth Engine User Interface API and publishing it to Google Cloud.</p>
<p><a href="https://www.youtube.com/watch?v=Y4lM7Wtckhs&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=6"><img src="https://img.youtube.com/vi/Y4lM7Wtckhs/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=Y4lM7Wtckhs&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=6">Watch the Video ↗</a></p>
<h2 id="01-client-vsserver">01. Client vs. Server</h2>
<p>The User Interface elements in your Code Editor - Map View, Drawing Tools etc. are ‘client-side’ elements. They run in YOUR browser. Image Collections, feature collections, calculations on Earth Engine objects etc. are ‘server-side’ elements. They run in Google’s data center. You cannot mix both these objects. To learn more, visit the <a href="https://developers.google.com/earth-engine/guides/client_server">Client vs. Server</a> section of the Earth Engine User Guide.</p>
<ul>
<li>To convert client-side objects to server-side objects, you can use the appropriate API function. Server-side functions start with <code>ee.</code>, such <code>ee.Date()</code>, <code>ee.Image()</code> etc.</li>
<li>To convert server-side objects to client-side objects, you can call <code>.getInfo()</code> on am Earth Engine object. For the Python API, this is the only way to extract information from a server-side object, but the Javascript API provides a better (and preferred) - method for bring server-side objects to client-side using the <code>evaluate()</code> method. This method asynchronously retrieves the value of the object, without blocking the user interface - meaning it will let your code continue to execute while it fetches the value.</li>
</ul>
<blockquote>
<p>Tip: You can use <code>ee.Algorithms.ObjectType()</code> to get the type of a server-side object</p>
</blockquote>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F01b_Client_vs_Server_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> date <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2020-01-01&#39;</span> <span style="color:#f92672">//</span> This is client<span style="color:#f92672">-</span>side
</span></span><span style="display:flex;"><span>print(typeof(date))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> eedate <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>)<span style="color:#f92672">.</span>format() <span style="color:#f92672">//</span> This is server<span style="color:#f92672">-</span>side
</span></span><span style="display:flex;"><span>print(typeof(eedate)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> To bring server<span style="color:#f92672">-</span>side objects to client<span style="color:#f92672">-</span>side, you can call <span style="color:#f92672">.</span>getInfo()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">var</span> clientdate <span style="color:#f92672">=</span> eedate<span style="color:#f92672">.</span>getInfo()
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> print(clientdate)
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> print(typeof(clientdate)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> getInfo() blocks the execution of your code till the value is fetched
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> If the value takes time to compute, your code editor will freeze
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is <span style="color:#f92672">not</span> a good user experience
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;COPERNICUS/S2_SR&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-02-01&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span><span style="color:#66d9ef">var</span> numImages <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>size()<span style="color:#f92672">.</span>getInfo()
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>print(numImages)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> A better approach is to use evaluate() function
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You need to define a <span style="color:#e6db74">&#39;callback&#39;</span> function which will be called once the 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> value has been computed <span style="color:#f92672">and</span> ready to be used<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myCallback <span style="color:#f92672">=</span> function(object) {
</span></span><span style="display:flex;"><span>  print(object)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;Computing the size of the collection&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> numImages <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>size()<span style="color:#f92672">.</span>evaluate(myCallback)
</span></span></code></pre></div><h3 id="exercise-17">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F01c_Client_vs_Server_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> date <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date<span style="color:#f92672">.</span>fromYMD(<span style="color:#ae81ff">2019</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>print(date)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We can use the format() function to create
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> a string from a date object
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dateString <span style="color:#f92672">=</span> date<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;dd MMM, YYYY&#39;</span>)
</span></span><span style="display:flex;"><span>print(dateString)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The print statement below combines a client<span style="color:#f92672">-</span>side string
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> with a server<span style="color:#f92672">-</span>side string <span style="color:#f92672">-</span> resulting <span style="color:#f92672">in</span> an error<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Fix the code so that the following message is printed
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#e6db74">&#39;The date is 01 Jan, 2019&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;The date is &#39;</span> <span style="color:#f92672">+</span> dateString
</span></span><span style="display:flex;"><span>print(message)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: 
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Convert the client<span style="color:#f92672">-</span>side string to a server<span style="color:#f92672">-</span>side string
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use ee<span style="color:#f92672">.</span>String() to create a server<span style="color:#f92672">-</span>side string
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Use the <span style="color:#f92672">.</span>cat() function instead of <span style="color:#f92672">+</span> to combine <span style="color:#ae81ff">2</span> strings
</span></span></code></pre></div><h2 id="02-using-ui-elements">02. Using UI Elements</h2>
<p>Earth Engine comes with a User Interface API that allows you to build an interactive web application powered by Earth Engine.</p>
<p>The Earth Engine API provides a library of User Interface (UI) widgets - such as Buttons, Drop-down Menus, Sliders etc. - that can be used to create interactive apps. All the user interface functions are contained in the <code>ui.</code> package - such as <code>ui.Select()</code>, <code>ui.Button()</code>. You can create those elements by calling these functions with appropriate parameters. Learn more in the <a href="https://developers.google.com/earth-engine/guides/ui">Earth Engine User Interface API</a> section of the Earth Engine User Guide.</p>
<p>This section shows how to build a drop-down selector using the <code>ui.Select()</code> widget.</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F02b_Using_UI_Elements_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> You can add any widgets from the ui<span style="color:#f92672">.*</span> module to the map
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> years <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;2014&#39;</span>, <span style="color:#e6db74">&#39;2015&#39;</span>, <span style="color:#e6db74">&#39;2016&#39;</span>, <span style="color:#e6db74">&#39;2017&#39;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Let<span style="color:#e6db74">&#39;s create a ui.Select() dropdown with the above values</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>  items: years,
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;2014&#39;</span>,
</span></span><span style="display:flex;"><span>  placeholder: <span style="color:#e6db74">&#39;Select a year&#39;</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>add(yearSelector);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> loadImage <span style="color:#f92672">=</span> function() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> year <span style="color:#f92672">=</span> yearSelector<span style="color:#f92672">.</span>getValue();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> col <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> startDate <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date<span style="color:#f92672">.</span>fromYMD(
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Number<span style="color:#f92672">.</span>parse(year), <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> endDate <span style="color:#f92672">=</span> startDate<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;year&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> col<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(startDate, endDate));
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;avg_rad&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> layerName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Night Lights &#39;</span> <span style="color:#f92672">+</span> year;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> nighttimeVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">60.0</span>};
</span></span><span style="display:flex;"><span>  Map<span style="color:#f92672">.</span>addLayer(composite, nighttimeVis, layerName);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> button <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Button({
</span></span><span style="display:flex;"><span>  label: <span style="color:#e6db74">&#39;Click to Load Image&#39;</span>,
</span></span><span style="display:flex;"><span>  onClick: loadImage,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>add(button);
</span></span></code></pre></div><h3 id="exercise-18">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F02c_Using_UI_Elements_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Instead of manually creating a list of years like before
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> we can create a list of years using ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> years <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">2014</span>, <span style="color:#ae81ff">2020</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Convert them to strings using format() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearStrings <span style="color:#f92672">=</span> years<span style="color:#f92672">.</span>map(function(year){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(year)<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%04d</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>print(yearStrings);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Convert the server<span style="color:#f92672">-</span>side object to client<span style="color:#f92672">-</span>side using
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> evaluate() <span style="color:#f92672">and</span> use it with ui<span style="color:#f92672">.</span>Select()
</span></span><span style="display:flex;"><span>yearStrings<span style="color:#f92672">.</span>evaluate(function(yearList) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> yearSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>    items: yearList,
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;2014&#39;</span>,
</span></span><span style="display:flex;"><span>    placeholder: <span style="color:#e6db74">&#39;Select a year&#39;</span>,
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>  Map<span style="color:#f92672">.</span>add(yearSelector)
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create another dropdown with months from <span style="color:#ae81ff">1</span> to <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#f92672">and</span> add it to the map<span style="color:#f92672">.</span>
</span></span></code></pre></div><h2 id="03-building-and-publishing-an-app">03. Building and Publishing an App</h2>
<p>Building a web mapping application typically requires the skills of a full stack developer and are out of reach for most analysts and scientists. But the Earth Engine User Interface API makes this process much more accessible by providing ready-to-use widgets and free cloud hosting to allow anyone to publish an app with just a few lines of code. The main container object is the <code>ui.Panel()</code> which can contain different types of widgets.</p>
<p>The code below shows how to build an app called <a href="https://santhosh-m.users.earthengine.app/view/night-lights-explorer">Night Lights Explorer</a> that allows anyone to pick a year/month and load the <em>VIIRS Nighttime Day/Night Band Composite</em> for the selected month. Copy/paste the code below to your Code Editor and click <em>Run</em>.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app1.png" alt=""></p>
<p>You will see a panel on the right-hand side with 2 drop-down boxes and a button. These are User Interface (UI) widgets provided by the Earth Engine API that allows the user to interactively select the values. You can select the values for <em>year</em> and <em>month</em> and click <em>Load</em> button to see the image for the selected month.</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F03b_Building_an_App_with_UI_Widgets_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Panels are the main container widgets
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> mainPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>  style: {width: <span style="color:#e6db74">&#39;300px&#39;</span>}
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> title <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label({
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;Night Lights Explorer&#39;</span>,
</span></span><span style="display:flex;"><span>  style: {<span style="color:#e6db74">&#39;fontSize&#39;</span>: <span style="color:#e6db74">&#39;24px&#39;</span>}
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can add widgets to the panel
</span></span><span style="display:flex;"><span>mainPanel<span style="color:#f92672">.</span>add(title);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can even add panels to other panels
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dropdownPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>  layout: ui<span style="color:#f92672">.</span>Panel<span style="color:#f92672">.</span>Layout<span style="color:#f92672">.</span>flow(<span style="color:#e6db74">&#39;horizontal&#39;</span>),
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>mainPanel<span style="color:#f92672">.</span>add(dropdownPanel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>  placeholder: <span style="color:#e6db74">&#39;please wait..&#39;</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> monthSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>  placeholder: <span style="color:#e6db74">&#39;please wait..&#39;</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> button <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Button(<span style="color:#e6db74">&#39;Load&#39;</span>)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(yearSelector)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(monthSelector)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(button)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Let<span style="color:#e6db74">&#39;s add a dropdown with the years</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> years <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">2014</span>, <span style="color:#ae81ff">2020</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> months <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Dropdown items need to be strings
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearStrings <span style="color:#f92672">=</span> years<span style="color:#f92672">.</span>map(function(year){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(year)<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%04d</span><span style="color:#e6db74">&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> monthStrings <span style="color:#f92672">=</span> months<span style="color:#f92672">.</span>map(function(month){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(month)<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%02d</span><span style="color:#e6db74">&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Evaluate the results <span style="color:#f92672">and</span> populate the dropdown
</span></span><span style="display:flex;"><span>yearStrings<span style="color:#f92672">.</span>evaluate(function(yearList) {
</span></span><span style="display:flex;"><span>  yearSelector<span style="color:#f92672">.</span>items()<span style="color:#f92672">.</span>reset(yearList);
</span></span><span style="display:flex;"><span>  yearSelector<span style="color:#f92672">.</span>setPlaceholder(<span style="color:#e6db74">&#39;select a year&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>monthStrings<span style="color:#f92672">.</span>evaluate(function(monthList) {
</span></span><span style="display:flex;"><span>  monthSelector<span style="color:#f92672">.</span>items()<span style="color:#f92672">.</span>reset(monthList);
</span></span><span style="display:flex;"><span>  monthSelector<span style="color:#f92672">.</span>setPlaceholder(<span style="color:#e6db74">&#39;select a month&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Define a function that triggers when any value is changed
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> loadComposite <span style="color:#f92672">=</span> function() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> col <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> year <span style="color:#f92672">=</span> yearSelector<span style="color:#f92672">.</span>getValue();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> month <span style="color:#f92672">=</span> monthSelector<span style="color:#f92672">.</span>getValue();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> startDate <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date<span style="color:#f92672">.</span>fromYMD(
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Number<span style="color:#f92672">.</span>parse(year), ee<span style="color:#f92672">.</span>Number<span style="color:#f92672">.</span>parse(month), <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> endDate <span style="color:#f92672">=</span> startDate<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> col<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(startDate, endDate));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>first())<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;avg_rad&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> nighttimeVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">60.0</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> layerName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Night Lights &#39;</span> <span style="color:#f92672">+</span> year <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> month;
</span></span><span style="display:flex;"><span>  Map<span style="color:#f92672">.</span>addLayer(image, nighttimeVis, layerName);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>button<span style="color:#f92672">.</span>onClick(loadComposite);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>setCenter(<span style="color:#ae81ff">76.43</span>, <span style="color:#ae81ff">12.41</span>, <span style="color:#ae81ff">8</span>);
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>add(mainPanel);
</span></span></code></pre></div><h3 id="exercise-19">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F03c_Building_an_App_with_UI_Widgets_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add a button called <span style="color:#e6db74">&#39;Reset&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Clicking the button should remove all loaded layers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: Use Map<span style="color:#f92672">.</span>clear() <span style="color:#66d9ef">for</span> removing the layers
</span></span></code></pre></div><h2 id="04-publishing-the-app">04. Publishing the App</h2>
<p>We will now publish this app. Click on the <em>Apps</em> button.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app2.png" alt="App with UI Elements"></p>
<p>App with UI Elements</p>
<p>In the <em>Manage Apps</em> window, click <em>New App</em>.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app3.png" alt=""></p>
<p>Select the existing project or create a new project. The app will be hosted on Google Cloud, so you will need to create and link a Google Cloud project with the app. If you don’t have a Google Cloud account, you can select the <em>Register a New Project</em> option to create a new project. You can provide an edit access based on the project selection.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app4.png" alt=""></p>
<p>Give the name of your app and see the URL created for your app.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app5.png" alt=""></p>
<p>Select code to use for the app. It can be from the current content or choose any repository path where the code is saved. We will go ahead with <em>Current contents of editor</em></p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app6.png" alt=""></p>
<p>Click next and in the <em>Publish New App</em> dialog, leave all other settings to default and click <em>Publish</em>.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app7.png" alt=""></p>
<p>The app will be hosted on Google Cloud and you can access it by clicking on the <em>App Name</em> of your app in the <em>Manage Apps</em> dialog.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app8.png" alt=""></p>
<p>You will see your Earth Engine powered app running in the browser. Anyone can access and interact with the app by just visiting the App URL.</p>
<blockquote>
<p>The app publishing process takes a few minutes. So if you get an error that your app is not yet ready, check back in a few minutes.</p>
</blockquote>
<p><a href="https://ujavalgandhi.users.earthengine.app/view/night-lights-explorer">Explore The App ↗</a></p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/app9.png" alt=""></p>
<h3 id="exercise-20">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F04c_Publishing_the_App_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#f92672">//</span> Panels are the main container widgets
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> mainPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>  style: {width: <span style="color:#e6db74">&#39;300px&#39;</span>}
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> title <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label({
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;Night Lights Explorer&#39;</span>,
</span></span><span style="display:flex;"><span>  style: {<span style="color:#e6db74">&#39;fontSize&#39;</span>: <span style="color:#e6db74">&#39;24px&#39;</span>}
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can add widgets to the panel
</span></span><span style="display:flex;"><span>mainPanel<span style="color:#f92672">.</span>add(title)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> You can even add panels to other panels
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> dropdownPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>  layout: ui<span style="color:#f92672">.</span>Panel<span style="color:#f92672">.</span>Layout<span style="color:#f92672">.</span>flow(<span style="color:#e6db74">&#39;horizontal&#39;</span>),
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>mainPanel<span style="color:#f92672">.</span>add(dropdownPanel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>  placeholder: <span style="color:#e6db74">&#39;please wait..&#39;</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> monthSelector <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Select({
</span></span><span style="display:flex;"><span>  placeholder: <span style="color:#e6db74">&#39;please wait..&#39;</span>,
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> button <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Button(<span style="color:#e6db74">&#39;Load&#39;</span>)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(yearSelector)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(monthSelector)
</span></span><span style="display:flex;"><span>dropdownPanel<span style="color:#f92672">.</span>add(button)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Let<span style="color:#e6db74">&#39;s add a dropdown with the years</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> years <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">2014</span>, <span style="color:#ae81ff">2020</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> months <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">12</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Dropdown items need to be strings
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> yearStrings <span style="color:#f92672">=</span> years<span style="color:#f92672">.</span>map(function(year){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(year)<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%04d</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> monthStrings <span style="color:#f92672">=</span> months<span style="color:#f92672">.</span>map(function(month){
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(month)<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%02d</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Evaluate the results <span style="color:#f92672">and</span> populate the dropdown
</span></span><span style="display:flex;"><span>yearStrings<span style="color:#f92672">.</span>evaluate(function(yearList) {
</span></span><span style="display:flex;"><span>  yearSelector<span style="color:#f92672">.</span>items()<span style="color:#f92672">.</span>reset(yearList)
</span></span><span style="display:flex;"><span>  yearSelector<span style="color:#f92672">.</span>setPlaceholder(<span style="color:#e6db74">&#39;select a year&#39;</span>)
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>monthStrings<span style="color:#f92672">.</span>evaluate(function(monthList) {
</span></span><span style="display:flex;"><span>  monthSelector<span style="color:#f92672">.</span>items()<span style="color:#f92672">.</span>reset(monthList)
</span></span><span style="display:flex;"><span>  monthSelector<span style="color:#f92672">.</span>setPlaceholder(<span style="color:#e6db74">&#39;select a month&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Define a function that triggers when any value is changed
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> loadComposite <span style="color:#f92672">=</span> function() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> col <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG&#34;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> year <span style="color:#f92672">=</span> yearSelector<span style="color:#f92672">.</span>getValue()
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> month <span style="color:#f92672">=</span> monthSelector<span style="color:#f92672">.</span>getValue()
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> startDate <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date<span style="color:#f92672">.</span>fromYMD(
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Number<span style="color:#f92672">.</span>parse(year), ee<span style="color:#f92672">.</span>Number<span style="color:#f92672">.</span>parse(month), <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> endDate <span style="color:#f92672">=</span> startDate<span style="color:#f92672">.</span>advance(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;month&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> col<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(startDate, endDate))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> image <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>first())<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;avg_rad&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> nighttimeVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">60.0</span>}
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> layerName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Night Lights &#39;</span> <span style="color:#f92672">+</span> year <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> month
</span></span><span style="display:flex;"><span>  Map<span style="color:#f92672">.</span>addLayer(image, nighttimeVis, layerName)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>button<span style="color:#f92672">.</span>onClick(loadComposite)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Set the map center to your area of interest
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Replace the author label with your name
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Publish the app<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>setCenter(<span style="color:#ae81ff">76.43</span>, <span style="color:#ae81ff">12.41</span>, <span style="color:#ae81ff">8</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> authorLabel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label(<span style="color:#e6db74">&#39;App by: Ujaval Gandhi&#39;</span>);
</span></span><span style="display:flex;"><span>mainPanel<span style="color:#f92672">.</span>add(authorLabel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>add(mainPanel);
</span></span></code></pre></div><h2 id="05-create-a-split-panel-app">05. Create a Split Panel App</h2>
<p>Another useful widget that can be used in Apps is <code>ui.SplitPanel()</code>. This allows you to create an app that can display 2 different images of the same region that can be explored interactively by swiping. Here we create an app to explore the <a href="https://developers.google.com/earth-engine/datasets/catalog/ESA_WorldCover_v100">ESA WorldCover 10m</a> global classification dataset.</p>
<p>On the left-hand panel, we will load a Sentinel-2 composite for the year 2020. On the right-hand panel, we will load the 11-class landcover classification of the same region.</p>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F05b_Split_Panel_App_(complete)">Open in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#34;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> selected <span style="color:#f92672">=</span> admin2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM1_NAME&#39;</span>, <span style="color:#e6db74">&#39;Karnataka&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM2_NAME&#39;</span>, <span style="color:#e6db74">&#39;Bangalore Urban&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> selected<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;COPERNICUS/S2_HARMONIZED&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Write a function to scale the bands
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> scaleImage <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>multiply(<span style="color:#ae81ff">0.0001</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>copyProperties(image, [<span style="color:#e6db74">&#34;system:time_start&#34;</span>])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2021-01-01&#39;</span>));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMaskedScaled <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>map(scaleImage);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a median composite <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">2020</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span>  filteredMaskedScaled<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load ESA WorldCover <span style="color:#ae81ff">2020</span> Classification
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> worldcover <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;ESA/WorldCover/v100&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> worldcover
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2021-01-01&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classification <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>first());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a Split <span style="color:#a6e22e">Panel</span> App
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Set a center <span style="color:#f92672">and</span> zoom level<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create two maps<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> leftMap <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rightMap <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Link them together<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> linker <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map<span style="color:#f92672">.</span>Linker([leftMap, rightMap]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a split panel with the two maps<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> splitPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>SplitPanel({
</span></span><span style="display:flex;"><span>  firstPanel: leftMap,
</span></span><span style="display:flex;"><span>  secondPanel: rightMap,
</span></span><span style="display:flex;"><span>  orientation: <span style="color:#e6db74">&#39;horizontal&#39;</span>,
</span></span><span style="display:flex;"><span>  wipe: true
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Remove the default map from the root panel<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>clear();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add our split panel to the root panel<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>add(splitPanel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add the layers to the maps
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Composite goes to the leftMap
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">0.3</span>, bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>]};
</span></span><span style="display:flex;"><span>leftMap<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;2020 Composite&#39;</span>);
</span></span><span style="display:flex;"><span>leftMap<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classification foes to the rightMap
</span></span><span style="display:flex;"><span>rightMap<span style="color:#f92672">.</span>addLayer(classification<span style="color:#f92672">.</span>clip(geometry), {}, <span style="color:#e6db74">&#39;WorldCover Classification&#39;</span>);
</span></span><span style="display:flex;"><span>rightMap<span style="color:#f92672">.</span>centerObject(geometry);
</span></span></code></pre></div><h3 id="exercise-21">Exercise</h3>
<p><a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3A05-Earth-Engine-Apps%2F05c_Split_Panel_App_(exercise)">Try in Code Editor ↗</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#34;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> selected <span style="color:#f92672">=</span> admin2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM1_NAME&#39;</span>, <span style="color:#e6db74">&#39;Karnataka&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM2_NAME&#39;</span>, <span style="color:#e6db74">&#39;Bangalore Urban&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> selected<span style="color:#f92672">.</span>geometry();
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;COPERNICUS/S2_HARMONIZED&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Write a function to scale the bands
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> scaleImage <span style="color:#f92672">=</span> function(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>multiply(<span style="color:#ae81ff">0.0001</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>copyProperties(image, [<span style="color:#e6db74">&#34;system:time_start&#34;</span>])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2021-01-01&#39;</span>));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load the Cloud Score<span style="color:#f92672">+</span> collection
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlus <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> csPlusBands <span style="color:#f92672">=</span> csPlus<span style="color:#f92672">.</span>first()<span style="color:#f92672">.</span>bandNames();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> We need to add Cloud Score <span style="color:#f92672">+</span> bands to each Sentinel<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> image <span style="color:#f92672">in</span> the collection
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This is done using the linkCollection() function
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredS2WithCs <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>linkCollection(csPlus, csPlusBands);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Function to mask pixels with low CS<span style="color:#f92672">+</span> QA scores<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>function maskLowQA(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qaBand <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cs&#39;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> clearThreshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(qaBand)<span style="color:#f92672">.</span>gte(clearThreshold);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMasked <span style="color:#f92672">=</span> filteredS2WithCs
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>map(maskLowQA);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filteredMaskedScaled <span style="color:#f92672">=</span> filteredMasked<span style="color:#f92672">.</span>map(scaleImage);
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a median composite <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">2020</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span>  filteredMaskedScaled<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Load ESA WorldCover <span style="color:#ae81ff">2020</span> Classification
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> worldcover <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#34;ESA/WorldCover/v100&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> worldcover
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2021-01-01&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> classification <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>first());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a Split <span style="color:#a6e22e">Panel</span> App
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create two maps<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> leftMap <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rightMap <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Link them together<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> linker <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Map<span style="color:#f92672">.</span>Linker([leftMap, rightMap]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create a split panel with the two maps<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> splitPanel <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>SplitPanel({
</span></span><span style="display:flex;"><span>  firstPanel: leftMap,
</span></span><span style="display:flex;"><span>  secondPanel: rightMap,
</span></span><span style="display:flex;"><span>  orientation: <span style="color:#e6db74">&#39;horizontal&#39;</span>,
</span></span><span style="display:flex;"><span>  wipe: true
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Remove the default map from the root panel<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>clear();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add our split panel to the root panel<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>ui<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>add(splitPanel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Add the layers to the maps
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Composite goes to the leftMap
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">0.3</span>, bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>]};
</span></span><span style="display:flex;"><span>leftMap<span style="color:#f92672">.</span>addLayer(composite<span style="color:#f92672">.</span>clip(geometry), rgbVis, <span style="color:#e6db74">&#39;2020 Composite&#39;</span>);
</span></span><span style="display:flex;"><span>leftMap<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Classification foes to the rightMap
</span></span><span style="display:flex;"><span>rightMap<span style="color:#f92672">.</span>addLayer(classification<span style="color:#f92672">.</span>clip(geometry), {}, <span style="color:#e6db74">&#39;WorldCover Classification&#39;</span>);
</span></span><span style="display:flex;"><span>rightMap<span style="color:#f92672">.</span>centerObject(geometry);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Adding a Legend
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The following code creates a legend with <span style="color:#66d9ef">class</span> names <span style="color:#f92672">and</span> colors
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create the panel <span style="color:#66d9ef">for</span> the legend items<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> legend <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>  style: {
</span></span><span style="display:flex;"><span>    position: <span style="color:#e6db74">&#39;middle-right&#39;</span>,
</span></span><span style="display:flex;"><span>    padding: <span style="color:#e6db74">&#39;8px 15px&#39;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Create <span style="color:#f92672">and</span> add the legend title<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> legendTitle <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label({
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;ESA WorldCover Classes&#39;</span>,
</span></span><span style="display:flex;"><span>  style: {
</span></span><span style="display:flex;"><span>    fontWeight: <span style="color:#e6db74">&#39;bold&#39;</span>,
</span></span><span style="display:flex;"><span>    fontSize: <span style="color:#e6db74">&#39;18px&#39;</span>,
</span></span><span style="display:flex;"><span>    margin: <span style="color:#e6db74">&#39;0 0 4px 0&#39;</span>,
</span></span><span style="display:flex;"><span>    padding: <span style="color:#e6db74">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>legend<span style="color:#f92672">.</span>add(legendTitle);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> loading <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label(<span style="color:#e6db74">&#39;Loading legend...&#39;</span>, {margin: <span style="color:#e6db74">&#39;2px 0 4px 0&#39;</span>});
</span></span><span style="display:flex;"><span>legend<span style="color:#f92672">.</span>add(loading);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Creates <span style="color:#f92672">and</span> styles <span style="color:#ae81ff">1</span> row of the legend<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> makeRow <span style="color:#f92672">=</span> function(color, name) {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> Create the label that is actually the colored box<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> colorBox <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label({
</span></span><span style="display:flex;"><span>    style: {
</span></span><span style="display:flex;"><span>      backgroundColor: <span style="color:#e6db74">&#39;#&#39;</span> <span style="color:#f92672">+</span> color,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">//</span> Use padding to give the box height <span style="color:#f92672">and</span> width<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>      padding: <span style="color:#e6db74">&#39;8px&#39;</span>,
</span></span><span style="display:flex;"><span>      margin: <span style="color:#e6db74">&#39;0 0 4px 0&#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">//</span> Create the label filled with the description text<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> description <span style="color:#f92672">=</span> ui<span style="color:#f92672">.</span>Label({
</span></span><span style="display:flex;"><span>    value: name,
</span></span><span style="display:flex;"><span>    style: {margin: <span style="color:#e6db74">&#39;0 0 4px 6px&#39;</span>}
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ui<span style="color:#f92672">.</span>Panel({
</span></span><span style="display:flex;"><span>    widgets: [colorBox, description],
</span></span><span style="display:flex;"><span>    layout: ui<span style="color:#f92672">.</span>Panel<span style="color:#f92672">.</span>Layout<span style="color:#f92672">.</span>Flow(<span style="color:#e6db74">&#39;horizontal&#39;</span>)
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> BAND_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Map&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Get the list of palette colors <span style="color:#f92672">and</span> <span style="color:#66d9ef">class</span> names from the image<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>classification<span style="color:#f92672">.</span>toDictionary()<span style="color:#f92672">.</span>select([BAND_NAME <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.*&#34;</span>])<span style="color:#f92672">.</span>evaluate(function(result) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> palette <span style="color:#f92672">=</span> result[BAND_NAME <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_class_palette&#34;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> names <span style="color:#f92672">=</span> result[BAND_NAME <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_class_names&#34;</span>];
</span></span><span style="display:flex;"><span>  loading<span style="color:#f92672">.</span>style()<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#39;shown&#39;</span>, false);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> names<span style="color:#f92672">.</span>length; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    legend<span style="color:#f92672">.</span>add(makeRow(palette[i], names[i]));
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Print the panel containing the legend
</span></span><span style="display:flex;"><span>print(legend);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Exercise
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Change the filter to select your chosen Admin2 region
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> The <span style="color:#e6db74">&#39;legend&#39;</span> varaible above is a panel containing the legend
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> <span style="color:#66d9ef">for</span> the classification<span style="color:#f92672">.</span> Add it to the map below
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: UI Widgets can only be shown once <span style="color:#f92672">in</span> the app<span style="color:#f92672">.</span> Remove the
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span>       print statement before adding the legend to the map<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Hint: Load the legend <span style="color:#f92672">in</span> the right<span style="color:#f92672">-</span>hand side map<span style="color:#f92672">.</span>
</span></span></code></pre></div><h2 id="module-6-google-earth-engine-python-api">Module 6: Google Earth Engine Python API</h2>
<h2 id="introduction-to-the-python-api">Introduction to the Python API</h2>
<p>Till this point in the course, we have used the Earth Engine Javascript API for all our analysis. Earth Engine also provides a Python API. If you are a Python programmer, you may prefer to use the Python API to integrate Earth Engine in your spatial analysis workflow. There are many options for running Python code that uses the Google Earth Engine API. We will use the following two methods in this course.</p>
<p><a href="https://www.youtube.com/watch?v=34yNkLmEHAI&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=7"><img src="https://img.youtube.com/vi/34yNkLmEHAI/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=34yNkLmEHAI&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=7">Watch the Video ↗</a></p>
<h3 id="google-colab">Google Colab</h3>
<p>An easy way to start using the Google Earth Engine Python API is via <a href="https://colab.research.google.com/">Google Colab</a>. Google Colaboratory provides a hosted environment to run Python notebooks without having to install Python locally. It also comes pre-installed with many useful packages - including the Google Earth Engine Python API. You can simply visit <a href="https://colab.research.google.com/">https://colab.research.google.com/</a> and start a new notebook.</p>
<h3 id="local-development-environment">Local Development Environment</h3>
<p>An advantage of Python API is that you can use it in your own development environment - so you get a lot more flexibility to automate as well as combine other analysis and visualization libraries with Earth Engine. This requires installing Python and the Earth Engine Python API on your machine or server. You also need to do a one-time authentication and save the token on the machine. The preferred method for installing the Earth Engine Python API is via Anaconda. Please follow our <a href="https://courses.spatialthoughts.com/install-gee-python-api.html">Google Earth Engine Python API Installation Guide</a> for step-by-step instructions.</p>
<h2 id="01-python-api-syntax">01. Python API Syntax</h2>
<p><a href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/01_python_api_syntax.ipynb">Open in Google Colab ↗</a></p>
<p>Coming from the programming in Earth Engine through the Code Editor, you will need to slightly adapt your scripts to be able to run in Python. For the bulk of your code, you will be using Earth Engine API’s server-side objects and functions - which will be exactly the same in Python. You only need to make a few syntactical changes.</p>
<p><a href="https://developers.google.com/earth-engine/python_install#syntax">Here’s the full list</a> of differences.</p>
<h4 id="initialization">Initialization</h4>
<p>First of all, you need to run the following cells to initialize the API and authorize your account. You must have a Google Cloud Project associated with your GEE account. Replace the <code>cloud_project</code> with your own project from <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<p>You will be prompted to allow the notebook to access your Google credentials to sign-in to the account and allow access to <em>Google Drive and Google Cloud data</em>. Once you approve, it will proceed to initialize the Earth Engine API. This step needs to be done just once per session.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cloud_project = &#39;spatialthoughts&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>try:
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span><span style="display:flex;"><span>except:
</span></span><span style="display:flex;"><span>    ee.Authenticate()
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span></code></pre></div><h4 id="variables">Variables</h4>
<p>Python code doesn’t use the ‘var’ keyword</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> city <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;San Fransico&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> state <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;California&#39;</span>
</span></span><span style="display:flex;"><span>print(city, state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> population <span style="color:#f92672">=</span> <span style="color:#ae81ff">881549</span>
</span></span><span style="display:flex;"><span>print(population)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>city = &#39;San Fransico&#39;
</span></span><span style="display:flex;"><span>state = &#39;California&#39;
</span></span><span style="display:flex;"><span>print(city, state)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>population = 881549
</span></span><span style="display:flex;"><span>print(population)
</span></span></code></pre></div><h4 id="earth-engine-objects">Earth Engine Objects</h4>
<p>You can create Earth Engine objects using the <code>ee</code> functions the same way.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>geometry = ee.Geometry.Polygon([[
</span></span><span style="display:flex;"><span>  [82.60642647743225, 27.16350437805251],
</span></span><span style="display:flex;"><span>  [82.60984897613525, 27.1618529901377],
</span></span><span style="display:flex;"><span>  [82.61088967323303, 27.163695288375266],
</span></span><span style="display:flex;"><span>  [82.60757446289062, 27.16517483230927]
</span></span><span style="display:flex;"><span>]])
</span></span></code></pre></div><h4 id="line-continuation">Line Continuation</h4>
<p>Python doesn’t use a semi-colon for line ending. To indicate line-continuation you need to use the \ character</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-02-01&#39;</span>, <span style="color:#e6db74">&#39;2019-03-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>filtered = s2 \
</span></span><span style="display:flex;"><span>    .filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30)) \
</span></span><span style="display:flex;"><span>    .filter(ee.Filter.date(&#39;2019-02-01&#39;, &#39;2019-03-01&#39;)) \
</span></span><span style="display:flex;"><span>    .filter(ee.Filter.bounds(geometry))
</span></span></code></pre></div><h4 id="functions">Functions</h4>
<p>Instead of the <code>function</code> keyword, Python uses the <code>def</code> keyword. Also the in-line functions are defined using <code>lambda</code> anonymous functions.</p>
<p>In the example below, also now the <code>and</code> operator - which is capitalized as <code>And</code> in Python version to avoid conflict with the built-in <code>and</code> operator. The same applies to <code>Or</code> and <code>Not</code> operators. <code>true</code>, <code>false</code>, <code>null</code> in Python are also spelled as <code>True</code>, <code>False</code> and <code>None</code>.</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>function maskS2clouds(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> qa <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;QA60&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> cloudBitMask <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> cirrusBitMask <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> mask <span style="color:#f92672">=</span> qa<span style="color:#f92672">.</span>bitwiseAnd(cloudBitMask)<span style="color:#f92672">.</span>eq(<span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span><span style="color:#f92672">and</span>(
</span></span><span style="display:flex;"><span>             qa<span style="color:#f92672">.</span>bitwiseAnd(cirrusBitMask)<span style="color:#f92672">.</span>eq(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>updateMask(mask)<span style="color:#f92672">//.</span>divide(<span style="color:#ae81ff">10000</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#34;B.*&#34;</span>)
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">.</span>copyProperties(image, [<span style="color:#e6db74">&#34;system:time_start&#34;</span>])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>function addNDVI(image) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> image<span style="color:#f92672">.</span>normalizedDifference([<span style="color:#e6db74">&#39;B8&#39;</span>, <span style="color:#e6db74">&#39;B4&#39;</span>])<span style="color:#f92672">.</span>rename(<span style="color:#e6db74">&#39;ndvi&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>addBands(ndvi);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>def maskS2clouds(image):
</span></span><span style="display:flex;"><span>  qa = image.select(&#39;QA60&#39;)
</span></span><span style="display:flex;"><span>  cloudBitMask = 1 &lt;&lt; 10
</span></span><span style="display:flex;"><span>  cirrusBitMask = 1 &lt;&lt; 11
</span></span><span style="display:flex;"><span>  mask = qa.bitwiseAnd(cloudBitMask).eq(0).And(
</span></span><span style="display:flex;"><span>             qa.bitwiseAnd(cirrusBitMask).eq(0))
</span></span><span style="display:flex;"><span>  return image.updateMask(mask) \
</span></span><span style="display:flex;"><span>      .select(&#34;B.*&#34;) \
</span></span><span style="display:flex;"><span>      .copyProperties(image, [&#34;system:time_start&#34;])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def addNDVI(image):
</span></span><span style="display:flex;"><span>  ndvi = image.normalizedDifference([&#39;B8&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;)
</span></span><span style="display:flex;"><span>  return image.addBands(ndvi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>withNdvi = filtered \
</span></span><span style="display:flex;"><span>    .map(maskS2clouds) \
</span></span><span style="display:flex;"><span>    .map(addNDVI)
</span></span></code></pre></div><h4 id="function-arguments">Function Arguments</h4>
<p>Named arguments to Earth Engine functions need to be in quotes. Also when passing the named arguments as a dictionary, it needs to be passed using the <code>**</code> keyword.</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> composite <span style="color:#f92672">=</span> withNdvi<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> ndvi <span style="color:#f92672">=</span> composite<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;ndvi&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> stats <span style="color:#f92672">=</span> ndvi<span style="color:#f92672">.</span>reduceRegion({
</span></span><span style="display:flex;"><span>    reducer: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>mean(),
</span></span><span style="display:flex;"><span>    geometry: geometry,
</span></span><span style="display:flex;"><span>    scale: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>    maxPixels: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>})    
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>composite = withNdvi.median()
</span></span><span style="display:flex;"><span>ndvi = composite.select(&#39;ndvi&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stats = ndvi.reduceRegion(**{
</span></span><span style="display:flex;"><span>  &#39;reducer&#39;: ee.Reducer.mean(),
</span></span><span style="display:flex;"><span>  &#39;geometry&#39;: geometry,
</span></span><span style="display:flex;"><span>  &#39;scale&#39;: 10,
</span></span><span style="display:flex;"><span>  &#39;maxPixels&#39;: 1e10
</span></span><span style="display:flex;"><span>  })
</span></span></code></pre></div><h4 id="printing-values">Printing Values</h4>
<p>The <code>print()</code> function syntax is the same. But you must remember that in the Code Editor when you cann <code>print</code>, the value of the server object is fetched and then printed. You must do that explicitely by calling <code>getInfo()</code> on any server-side object.</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>print(stats.get(&#39;ndvi&#39;)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>print(stats.get(&#39;ndvi&#39;).getInfo())
</span></span></code></pre></div><h4 id="in-line-functions">In-line functions</h4>
<p>The syntax for defining in-line functions is also slightly different. You need to use the <code>lambda</code> keyword.</p>
<p>javascript code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> myList <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>List<span style="color:#f92672">.</span>sequence(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> newList <span style="color:#f92672">=</span> myList<span style="color:#f92672">.</span>map(function(number) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ee<span style="color:#f92672">.</span>Number(number)<span style="color:#f92672">.</span>pow(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>print(newList);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>myList = ee.List.sequence(1, 10)
</span></span><span style="display:flex;"><span>newList = myList.map(lambda number: ee.Number(number).pow(2))
</span></span><span style="display:flex;"><span>print(newList.getInfo())
</span></span></code></pre></div><h3 id="exercise-22">Exercise</h3>
<p>Take the Javascript code snippet below and write the equiavalent Python code in the cell below.</p>
<ul>
<li><strong>Hint1</strong>: Chaining of filters require the use of line continuation character <code>\</code></li>
<li><strong>Hint2</strong>: Printing of server-side objects requires calling <code>.getInfo()</code> on the object</li>
</ul>
<p>The correct code should print the value <strong>30</strong>.</p>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Point([<span style="color:#ae81ff">77.60412933051538</span>, <span style="color:#ae81ff">12.952912912328241</span>]);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>print(filtered<span style="color:#f92672">.</span>size());
</span></span></code></pre></div><hr>
<h2 id="02-automatic-conversion-of-javascript-code-to-python">02. Automatic Conversion of Javascript Code to Python</h2>
<p><a href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/02_automatic_conversion_of_scripts.ipynb">Open in Google Colab ↗</a></p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/automatic_conversion.png" alt="Interactive leaflet map created by geemap"></p>
<p>Interactive leaflet map created by geemap</p>
<p><a href="https://github.com/giswqs/geemap">geemap</a> is an open-source Python package that comes with many helpful features that help you use Earth Engine effectively in Python.</p>
<p>It comes with a function that can help you translate your javascript earth engine code to Python automatically.</p>
<p>The <code>geemap</code> package is pre-installed in Colab.</p>
<h4 id="initialization-1">Initialization</h4>
<p>First of all, you need to run the following cells to initialize the API and authorize your account. You must have a Google Cloud Project associated with your GEE account. Replace the <code>cloud_project</code> with your own project from <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cloud_project = &#39;spatialthoughts&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>try:
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span><span style="display:flex;"><span>except:
</span></span><span style="display:flex;"><span>    ee.Authenticate()
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span></code></pre></div><h4 id="automatic-conversion-using-gui">Automatic Conversion using GUI</h4>
<p><code>geemap</code> comes with a user interface that can be used to interactively do code conversion. Let’s try to convert the following Javascript code to Python.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> geometry <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Geometry<span style="color:#f92672">.</span>Point([<span style="color:#ae81ff">77.60412933051538</span>, <span style="color:#ae81ff">12.952912912328241</span>]);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> s2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;COPERNICUS/S2_HARMONIZED&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> rgbVis <span style="color:#f92672">=</span> {min: <span style="color:#ae81ff">0.0</span>, max: <span style="color:#ae81ff">3000</span>, bands: [<span style="color:#e6db74">&#39;B4&#39;</span>, <span style="color:#e6db74">&#39;B3&#39;</span>, <span style="color:#e6db74">&#39;B2&#39;</span>]};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> filtered <span style="color:#f92672">=</span> s2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>lt(<span style="color:#e6db74">&#39;CLOUDY_PIXEL_PERCENTAGE&#39;</span>, <span style="color:#ae81ff">30</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2019-01-01&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry));
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> medianComposite <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>median();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(geometry, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(medianComposite, rgbVis, <span style="color:#e6db74">&#39;Median Composite&#39;</span>);
</span></span></code></pre></div><p>Run the cell below to load the map widget. Once the map widget loads, click the <em>Toolbar</em> icon in the top-right corner and select the <em>Convert Earth Engine Javascript to Python</em> tool. Paste your Javascript code and click <em>Convert</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>m = geemap.Map(width=800)
</span></span><span style="display:flex;"><span>m
</span></span></code></pre></div><p>You will see the auto-converted code displayed. Copy and paste it into a new cell and run it. Your code will be run using the GEE Python API.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>geometry = ee.Geometry.Point([77.60412933051538, 12.952912912328241])
</span></span><span style="display:flex;"><span>s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rgbVis = {&#39;min&#39;: 0.0, &#39;max&#39;: 3000, &#39;bands&#39;: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;]}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = s2.filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>medianComposite = filtered.median()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m.centerObject(geometry, 10)
</span></span><span style="display:flex;"><span>m.addLayer(medianComposite, rgbVis, &#39;Median Composite&#39;)
</span></span></code></pre></div><p>If your code loads any layers, they will be loaded on the map widget. To display it, open a new code cell and just type <code>m</code> to display the widget.</p>
<h4 id="automatic-conversion-using-code">Automatic Conversion using Code</h4>
<p><code>geemap</code> offers a function <code>js_snippet_to_py()</code> that can be used to perform the conversion using code. This is useful for batch conversions. To use this, we first create a string with the javascript code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>javascript_code <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var geometry = ee.Geometry.Point([107.61303468448624, 12.130969369851766]);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Map.centerObject(geometry, 12)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var rgbVis = {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  min: 0.0,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  max: 3000,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  bands: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;],
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">};
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var filtered = s2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  .filter(ee.Filter.bounds(geometry))
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Load the Cloud Score+ collection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var csPlus = ee.ImageCollection(&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var csPlusBands = csPlus.first().bandNames();
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// We need to add Cloud Score + bands to each Sentinel-2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// image in the collection
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// This is done using the linkCollection() function
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var filteredS2WithCs = filtered.linkCollection(csPlus, csPlusBands);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Function to mask pixels with low CS+ QA scores.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function maskLowQA(image) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  var qaBand = &#39;cs&#39;;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  var clearThreshold = 0.5;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  var mask = image.select(qaBand).gte(clearThreshold);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  return image.updateMask(mask);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var filteredMasked = filteredS2WithCs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  .map(maskLowQA);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">// Write a function that computes NDVI for an image and adds it as a band
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">function addNDVI(image) {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  var ndvi = image.normalizedDifference([&#39;B5&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  return image.addBands(ndvi);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var withNdvi = filteredMasked.map(addNDVI);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">var composite = withNdvi.median()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">palette = [
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#39;CE7E45&#39;, &#39;DF923D&#39;, &#39;F1B555&#39;, &#39;FCD163&#39;, &#39;99B718&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#39;74A901&#39;, &#39;66A000&#39;, &#39;529400&#39;, &#39;3E8601&#39;, &#39;207401&#39;, &#39;056201&#39;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#39;004C00&#39;, &#39;023B01&#39;, &#39;012E01&#39;, &#39;011D01&#39;, &#39;011301&#39;];
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">ndviVis = {min:0, max:0.7, palette: palette }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Map.addLayer(withNdvi.select(&#39;ndvi&#39;), ndviVis, &#39;NDVI Composite&#39;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>lines = geemap.js_snippet_to_py(
</span></span><span style="display:flex;"><span>    javascript_code, add_new_cell=False,
</span></span><span style="display:flex;"><span>    import_ee=True, import_geemap=True, show_map=True)
</span></span><span style="display:flex;"><span>for line in lines:
</span></span><span style="display:flex;"><span>    print(line.rstrip())
</span></span></code></pre></div><p>The automatic conversion works great. Review it and paste it to the cell below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span>import geemap
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m = geemap.Map()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>geometry = ee.Geometry.Point([107.61303468448624, 12.130969369851766])
</span></span><span style="display:flex;"><span>m.centerObject(geometry, 12)
</span></span><span style="display:flex;"><span>s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>rgbVis = {
</span></span><span style="display:flex;"><span>  &#39;min&#39;: 0.0,
</span></span><span style="display:flex;"><span>  &#39;max&#39;: 3000,
</span></span><span style="display:flex;"><span>  &#39;bands&#39;: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = s2 \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Load the Cloud Score+ collection
</span></span><span style="display:flex;"><span>csPlus = ee.ImageCollection(&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>csPlusBands = csPlus.first().bandNames()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># We need to add Cloud Score + bands to each Sentinel-2
</span></span><span style="display:flex;"><span># image in the collection
</span></span><span style="display:flex;"><span># This is done using the linkCollection() function
</span></span><span style="display:flex;"><span>filteredS2WithCs = filtered.linkCollection(csPlus, csPlusBands)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Function to mask pixels with low CS+ QA scores.
</span></span><span style="display:flex;"><span>def maskLowQA(image):
</span></span><span style="display:flex;"><span>  qaBand = &#39;cs&#39;
</span></span><span style="display:flex;"><span>  clearThreshold = 0.5
</span></span><span style="display:flex;"><span>  mask = image.select(qaBand).gte(clearThreshold)
</span></span><span style="display:flex;"><span>  return image.updateMask(mask)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filteredMasked = filteredS2WithCs \
</span></span><span style="display:flex;"><span>  .map(maskLowQA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Write a function that computes NDVI for an image and adds it as a band
</span></span><span style="display:flex;"><span>def addNDVI(image):
</span></span><span style="display:flex;"><span>  ndvi = image.normalizedDifference([&#39;B5&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;)
</span></span><span style="display:flex;"><span>  return image.addBands(ndvi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>withNdvi = filteredMasked.map(addNDVI)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>composite = withNdvi.median()
</span></span><span style="display:flex;"><span>palette = [
</span></span><span style="display:flex;"><span>  &#39;CE7E45&#39;, &#39;DF923D&#39;, &#39;F1B555&#39;, &#39;FCD163&#39;, &#39;99B718&#39;,
</span></span><span style="display:flex;"><span>  &#39;74A901&#39;, &#39;66A000&#39;, &#39;529400&#39;, &#39;3E8601&#39;, &#39;207401&#39;, &#39;056201&#39;,
</span></span><span style="display:flex;"><span>  &#39;004C00&#39;, &#39;023B01&#39;, &#39;012E01&#39;, &#39;011D01&#39;, &#39;011301&#39;]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ndviVis = {&#39;min&#39;:0, &#39;max&#39;:0.7, &#39;palette&#39;: palette }
</span></span><span style="display:flex;"><span>m.addLayer(withNdvi.select(&#39;ndvi&#39;), ndviVis, &#39;NDVI Composite&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>m
</span></span></code></pre></div><h3 id="exercise-23">Exercise</h3>
<p>Take the Javascript code snippet below and use <code>geemap</code> to automatically convert it to Python.</p>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#34;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> karnataka <span style="color:#f92672">=</span> admin2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM1_NAME&#39;</span>, <span style="color:#e6db74">&#39;Karnataka&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> visParams <span style="color:#f92672">=</span> {color: <span style="color:#e6db74">&#39;red&#39;</span>}
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>centerObject(karnataka)
</span></span><span style="display:flex;"><span>Map<span style="color:#f92672">.</span>addLayer(karnataka, visParams, <span style="color:#e6db74">&#39;Karnataka Districts&#39;</span>)
</span></span></code></pre></div><hr>
<h2 id="03-batch-exports">03. Batch Exports</h2>
<p><a href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/03_export_a_collection.ipynb">Open in Google Colab ↗</a></p>
<p>One of the most commonly asked questions by Earth Engine users is - <em>How do I download all images in a collection</em>? The Earth Engine Python API comes with a <code>ee.batch</code> module that allows you to launch batch exports and manage tasks. The recommended way to do batch exports like this is to use the Python API’s <code>ee.batch.Export</code> functions and use a Python for-loop to iterate and export each image. The <code>ee.batch</code> module also gives you ability to control <em>Tasks</em> - allowing you to automate exports.</p>
<blockquote>
<p>You can also export images in a collection using Javascript API in the Code Editor but this requires you to manually start the tasks for each image. This approach is fine for small number of images. You can check out the <a href="https://code.earthengine.google.co.in/?scriptPath=users%2Fujavalgandhi%2FEnd-to-End-GEE%3ASupplement%2FImage_Collections%2FExporting_ImageCollections">recommended script</a>.</p>
</blockquote>
<h4 id="initialization-2">Initialization</h4>
<p>First of all, you need to run the following cells to initialize the API and authorize your account. You must have a Google Cloud Project associated with your GEE account. Replace the <code>cloud_project</code> with your own project from <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cloud_project = &#39;spatialthoughts&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>try:
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span><span style="display:flex;"><span>except:
</span></span><span style="display:flex;"><span>    ee.Authenticate()
</span></span><span style="display:flex;"><span>    ee.Initialize(project=cloud_project)
</span></span></code></pre></div><h4 id="create-a-collection">Create a Collection</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>geometry = ee.Geometry.Point([107.61303468448624, 12.130969369851766])
</span></span><span style="display:flex;"><span>s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>rgbVis = {
</span></span><span style="display:flex;"><span>  &#39;min&#39;: 0.0,
</span></span><span style="display:flex;"><span>  &#39;max&#39;: 3000,
</span></span><span style="display:flex;"><span>  &#39;bands&#39;: [&#39;B4&#39;, &#39;B3&#39;, &#39;B2&#39;],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = s2 \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(&#39;2019-01-01&#39;, &#39;2020-01-01&#39;)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.bounds(geometry)) \
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Load the Cloud Score+ collection
</span></span><span style="display:flex;"><span>csPlus = ee.ImageCollection(&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>csPlusBands = csPlus.first().bandNames()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># We need to add Cloud Score + bands to each Sentinel-2
</span></span><span style="display:flex;"><span># image in the collection
</span></span><span style="display:flex;"><span># This is done using the linkCollection() function
</span></span><span style="display:flex;"><span>filteredS2WithCs = filtered.linkCollection(csPlus, csPlusBands)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Function to mask pixels with low CS+ QA scores.
</span></span><span style="display:flex;"><span>def maskLowQA(image):
</span></span><span style="display:flex;"><span>  qaBand = &#39;cs&#39;
</span></span><span style="display:flex;"><span>  clearThreshold = 0.5
</span></span><span style="display:flex;"><span>  mask = image.select(qaBand).gte(clearThreshold)
</span></span><span style="display:flex;"><span>  return image.updateMask(mask)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filteredMasked = filteredS2WithCs \
</span></span><span style="display:flex;"><span>  .map(maskLowQA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Write a function that computes NDVI for an image and adds it as a band
</span></span><span style="display:flex;"><span>def addNDVI(image):
</span></span><span style="display:flex;"><span>  ndvi = image.normalizedDifference([&#39;B5&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;)
</span></span><span style="display:flex;"><span>  return image.addBands(ndvi)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>withNdvi = filteredMasked.map(addNDVI)
</span></span></code></pre></div><h4 id="export-all-images">Export All Images</h4>
<p>Exports are done via the <code>ee.batch</code> module. This module allows you to automatically start an export - making it suitable for batch exports.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>image_ids = withNdvi.aggregate_array(&#39;system:index&#39;).getInfo()
</span></span><span style="display:flex;"><span>print(&#39;Total images: &#39;, len(image_ids))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#75715e"># Export with 100m resolution for this demo</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, image_id <span style="color:#f92672">in</span> enumerate(image_ids):
</span></span><span style="display:flex;"><span>  image <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(withNdvi<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;system:index&#39;</span>, image_id))<span style="color:#f92672">.</span>first())
</span></span><span style="display:flex;"><span>  task <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toDrive(<span style="color:#f92672">**</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;image&#39;</span>: image<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;ndvi&#39;</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">&#39;Image Export {}&#39;</span><span style="color:#f92672">.</span>format(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;fileNamePrefix&#39;</span>: image_id,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;folder&#39;</span>:<span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;scale&#39;</span>: <span style="color:#ae81ff">100</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;region&#39;</span>: image<span style="color:#f92672">.</span>geometry(),
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;maxPixels&#39;</span>: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  task<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>  print(<span style="color:#e6db74">&#39;Started Task: &#39;</span>, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><h4 id="manage-runningwaiting-tasks">Manage Running/Waiting Tasks</h4>
<p>You can manage tasks as well. Get a list of tasks and get state information on them</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tasks = ee.batch.Task.list()
</span></span><span style="display:flex;"><span>for task in tasks:
</span></span><span style="display:flex;"><span>  task_id = task.status()[&#39;id&#39;]
</span></span><span style="display:flex;"><span>  task_state = task.status()[&#39;state&#39;]
</span></span><span style="display:flex;"><span>  print(task_id, task_state)
</span></span></code></pre></div><p>You can cancel tasks as well</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>tasks = ee.batch.Task.list()
</span></span><span style="display:flex;"><span>for task in tasks:
</span></span><span style="display:flex;"><span>    task_id = task.status()[&#39;id&#39;]
</span></span><span style="display:flex;"><span>    task_state = task.status()[&#39;state&#39;]
</span></span><span style="display:flex;"><span>    if task_state == &#39;RUNNING&#39; or task_state == &#39;READY&#39;:
</span></span><span style="display:flex;"><span>        task.cancel()
</span></span><span style="display:flex;"><span>        print(&#39;Task {} canceled&#39;.format(task_id))
</span></span><span style="display:flex;"><span>    else:
</span></span><span style="display:flex;"><span>        print(&#39;Task {} state is {}&#39;.format(task_id, task_state))
</span></span></code></pre></div><h3 id="exercise-24">Exercise</h3>
<p>The code below uses the TerraClimate data and creates an ImageCollection with 12 monthly images of maximum temperature. It also extract the geometry for Australia from the LSIB collection. Add the code to start an export task for each image in the collection for australia.</p>
<ul>
<li><strong>Hint1</strong>: TerraClimate images have a scale of 4638.3m</li>
<li><strong>Hint2</strong>: You need to export the image contained in the clippedImage variable</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lsib = ee.FeatureCollection(&#39;USDOS/LSIB_SIMPLE/2017&#39;)
</span></span><span style="display:flex;"><span>australia = lsib.filter(ee.Filter.eq(&#39;country_na&#39;, &#39;Australia&#39;))
</span></span><span style="display:flex;"><span>geometry = australia.geometry()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>terraclimate = ee.ImageCollection(&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;)
</span></span><span style="display:flex;"><span>tmax = terraclimate.select(&#39;tmmx&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def scale(image):
</span></span><span style="display:flex;"><span>  return image.multiply(0.1) \
</span></span><span style="display:flex;"><span>    .copyProperties(image,[&#39;system:time_start&#39;])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tmaxScaled = tmax.map(scale)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = tmaxScaled \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(&#39;2020-01-01&#39;, &#39;2021-01-01&#39;)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_ids = filtered.aggregate_array(&#39;system:index&#39;).getInfo()
</span></span><span style="display:flex;"><span>print(&#39;Total images: &#39;, len(image_ids))
</span></span></code></pre></div><p>Replace the comments with your code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, image_id <span style="color:#f92672">in</span> enumerate(image_ids):
</span></span><span style="display:flex;"><span>    exportImage <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;system:index&#39;</span>, image_id))<span style="color:#f92672">.</span>first())
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Clip the image to the region geometry</span>
</span></span><span style="display:flex;"><span>    clippedImage <span style="color:#f92672">=</span> exportImage<span style="color:#f92672">.</span>clip(geometry)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## Create the export task using ee.batch.Export.image.toDrive()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">## Start the task</span>
</span></span></code></pre></div><p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/exporting_a_collection.png" alt="Launching multiple tasks using the  Python API"></p>
<p>Launching multiple tasks using the Python API</p>
<h2 id="04-using-earth-engine-with-xarray">04. Using Earth Engine with XArray</h2>
<p><a href="https://colab.research.google.com/github/spatialthoughts/courses/blob/master/code/end_to_end_gee/04_time_series_processing_xee.ipynb">Open in Google Colab ↗</a></p>
<p><a href="https://github.com/google/Xee">XEE</a> is an python package for working with Google Earth Engine data with <a href="https://docs.xarray.dev/en/stable/">XArray</a>. XEE makes it possible to leverage the strengths of both GEE and the Python ecosystem around XArray.</p>
<p>We will learn how to use XEE to extract and process a NDVI time-series for a single point location.</p>
<p>If you want to download processed time-series images as GeoTIFF files, pleasee see <a href="https://courses.spatialthoughts.com/python-remote-sensing.html#processing-time-series">this notebook</a>.</p>
<h4 id="installation">Installation</h4>
<p>Let’s install the required packages in the Colab environment.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>%%capture
</span></span><span style="display:flex;"><span>if &#39;google.colab&#39; in str(get_ipython()):
</span></span><span style="display:flex;"><span>    !pip install --upgrade xee
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span>import xarray
</span></span><span style="display:flex;"><span>import matplotlib.pyplot as plt
</span></span></code></pre></div><h4 id="initialization-3">Initialization</h4>
<p>First of all, you need to run the following cells to initialize the API and authorize your account. You must have a Google Cloud Project associated with your GEE account. Replace the <code>cloud_project</code> with your own project from <a href="https://console.cloud.google.com/">Google Cloud Console</a>.</p>
<p>We are using the <a href="https://developers.google.com/earth-engine/cloud/highvolume">High-volume Endpoint</a> which supports large number of concurrent requests and is recommended when working with XEE.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>cloud_project = &#39;spatialthoughts&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>try:
</span></span><span style="display:flex;"><span>    ee.Initialize(
</span></span><span style="display:flex;"><span>        project=cloud_project,
</span></span><span style="display:flex;"><span>        opt_url=&#39;https://earthengine-highvolume.googleapis.com&#39;
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>except:
</span></span><span style="display:flex;"><span>    ee.Authenticate()
</span></span><span style="display:flex;"><span>    ee.Initialize(
</span></span><span style="display:flex;"><span>        project=cloud_project,
</span></span><span style="display:flex;"><span>        opt_url=&#39;https://earthengine-highvolume.googleapis.com&#39;
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div><h4 id="select-a-location">Select a location.</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>geometry = ee.Geometry.Point([82.60759592318209, 27.163481733946846])
</span></span></code></pre></div><h4 id="preprocess-the-data-in-gee">Preprocess the data in GEE</h4>
<p>We start with the Sentinel-2 L1C collection. We pre-process the data by applying cloud masking and pixel scaling.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>s2 = ee.ImageCollection(&#39;COPERNICUS/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = s2 \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(&#39;2017-01-01&#39;, &#39;2018-01-01&#39;)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.lt(&#39;CLOUDY_PIXEL_PERCENTAGE&#39;, 30)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Load the Cloud Score+ collection
</span></span><span style="display:flex;"><span>csPlus = ee.ImageCollection(&#39;GOOGLE/CLOUD_SCORE_PLUS/V1/S2_HARMONIZED&#39;)
</span></span><span style="display:flex;"><span>csPlusBands = csPlus.first().bandNames()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># We need to add Cloud Score + bands to each Sentinel-2
</span></span><span style="display:flex;"><span># image in the collection
</span></span><span style="display:flex;"><span># This is done using the linkCollection() function
</span></span><span style="display:flex;"><span>filteredS2WithCs = filtered.linkCollection(csPlus, csPlusBands)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Function to mask pixels with low CS+ QA scores.
</span></span><span style="display:flex;"><span>def maskLowQA(image):
</span></span><span style="display:flex;"><span>  qaBand = &#39;cs&#39;
</span></span><span style="display:flex;"><span>  clearThreshold = 0.5
</span></span><span style="display:flex;"><span>  mask = image.select(qaBand).gte(clearThreshold)
</span></span><span style="display:flex;"><span>  return image.updateMask(mask)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filteredMasked = filteredS2WithCs \
</span></span><span style="display:flex;"><span>  .map(maskLowQA)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Write a function that computes NDVI for an image and adds it as a band
</span></span><span style="display:flex;"><span># Create a new image to overcome https://github.com/google/Xee/issues/88
</span></span><span style="display:flex;"><span>def addNDVI(image):
</span></span><span style="display:flex;"><span>  ndvi = image.normalizedDifference([&#39;B8&#39;, &#39;B4&#39;]).rename(&#39;ndvi&#39;)
</span></span><span style="display:flex;"><span>  return image.multiply(0.0001).addBands(ndvi)\
</span></span><span style="display:flex;"><span>    .copyProperties(image, [&#39;system:time_start&#39;])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Map the function over the collection
</span></span><span style="display:flex;"><span>withNdvi = filteredMasked.map(addNDVI)
</span></span></code></pre></div><h4 id="load-imagecollection-as-xarray-dataset">Load ImageCollection as XArray Dataset</h4>
<p>Now we have an ImageCollection that we want to get it as a XArray Dataset. We define the region of interest and extract the ImageCollection using the <code>ee</code> engine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ds = xarray.open_dataset(
</span></span><span style="display:flex;"><span>    withNdvi,
</span></span><span style="display:flex;"><span>    engine=&#39;ee&#39;,
</span></span><span style="display:flex;"><span>    crs=&#39;EPSG:3857&#39;,
</span></span><span style="display:flex;"><span>    scale=10,
</span></span><span style="display:flex;"><span>    geometry=geometry,
</span></span><span style="display:flex;"><span>    ee_mask_value=-9999,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ds
</span></span></code></pre></div><p>Select the <code>ndvi</code> band.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ndvi_time_series = ds.ndvi
</span></span></code></pre></div><p>Run <code>compute()</code> to fetch the pixels from Earth Engine. This may take some time depending on the size of the request. This is a time-series at a single pixel, so we also <code>squeeze()</code> to remove the X and Y dimensions and get an array of NDVI values.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>original_time_series = ndvi_time_series.compute()
</span></span><span style="display:flex;"><span>original_time_series = original_time_series.squeeze()
</span></span><span style="display:flex;"><span>original_time_series
</span></span></code></pre></div><p>Plot the time-series.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>fig, ax = plt.subplots(1, 1)
</span></span><span style="display:flex;"><span>fig.set_size_inches(10, 5)
</span></span><span style="display:flex;"><span>original_time_series.plot.line(
</span></span><span style="display:flex;"><span>    ax=ax, x=&#39;time&#39;,
</span></span><span style="display:flex;"><span>    marker=&#39;o&#39;, color=&#39;#66c2a4&#39;, linestyle=&#39;--&#39;, linewidth=1, markersize=4)
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></div><h4 id="process-time-series-using-xarray">Process Time-Series using XArray</h4>
<p>We use XArray’s excellent time-series processing functionality to process the time-series. First, we create a regularly spaced time-series.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>time_series_resampled = original_time_series\
</span></span><span style="display:flex;"><span>  .resample(time=&#39;5d&#39;).mean(dim=&#39;time&#39;)
</span></span><span style="display:flex;"><span>time_series_resampled
</span></span></code></pre></div><p>Next we fill the cloud-masked pixels with linearly interpolated values from temporal neighbors.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>time_series_interpolated = time_series_resampled\
</span></span><span style="display:flex;"><span>  .interpolate_na(&#39;time&#39;, use_coordinate=False)
</span></span><span style="display:flex;"><span>time_series_interpolated
</span></span></code></pre></div><p>We also apply a moving-window smoothing to remove noise.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>time_series_smooth = time_series_interpolated\
</span></span><span style="display:flex;"><span>  .rolling(time=3, center=True).mean()
</span></span><span style="display:flex;"><span>time_series_smooth
</span></span></code></pre></div><p>A moving-window smoothing removed the first and last values of the time-series. We anchor the smoothed time-series with the values from the original time-series.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>time_series_smooth[0] = original_time_series[0]
</span></span><span style="display:flex;"><span>time_series_smooth[-1] = original_time_series[-1]
</span></span><span style="display:flex;"><span>time_series_smooth
</span></span></code></pre></div><p>Plot the original and smoothed time-series.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>fig, ax = plt.subplots(1, 1)
</span></span><span style="display:flex;"><span>fig.set_size_inches(10, 5)
</span></span><span style="display:flex;"><span>original_time_series.plot.line(
</span></span><span style="display:flex;"><span>    ax=ax, x=&#39;time&#39;,
</span></span><span style="display:flex;"><span>    marker=&#39;^&#39;, color=&#39;#66c2a4&#39;, linestyle=&#39;--&#39;, linewidth=1, markersize=2)
</span></span><span style="display:flex;"><span>time_series_smooth.plot.line(
</span></span><span style="display:flex;"><span>    ax=ax, x=&#39;time&#39;,
</span></span><span style="display:flex;"><span>    marker=&#39;o&#39;, color=&#39;#238b45&#39;, linestyle=&#39;-&#39;, linewidth=1, markersize=4)
</span></span><span style="display:flex;"><span>plt.show()
</span></span></code></pre></div><h4 id="download-the-time-series">Download the Time-Series</h4>
<p>Convert the DataArray to a Pandas DataFrame and save it as a CSV file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>df = time_series_smooth.to_dataframe(&#39;ndvi&#39;).reset_index()
</span></span><span style="display:flex;"><span>df
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>output_filename = &#39;smoothed_time_series.csv&#39;
</span></span><span style="display:flex;"><span>df[[&#39;time&#39;, &#39;ndvi&#39;]].to_csv(output_filename, index=False)
</span></span></code></pre></div><h3 id="exercise-25">Exercise</h3>
<p>Replace the <code>geometry</code> with the location of your choice. Extract and download the smoothed time-series as a CSV file.</p>
<h2 id="05-automating-downloads">05. Automating Downloads</h2>
<p>Another common use of the GEE Python API is to automate data processing and export. You can create a Python script that can be called from a server or launched on a schedule using tools such as <a href="https://medium.com/@roddyjaques/how-to-run-anaconda-programs-with-a-bat-file-5f6dd7675508">Windows Scheduler</a> or <a href="https://donny-son.github.io/posts/cronjob-with-conda/">crontab</a>.</p>
<p>This script below provides a complete example of automating a download using Google Earth Engine API. It uses the Google Earth Engine API to compute the average soil moisture for the given time period over all districts in a state. The result is then downloaded as a CSV file and saved locally.</p>
<blockquote>
<p>Before running the script, please install the Earth Engine Python Client Library and commplete the authentication workflow on your machine using our <a href="https://courses.spatialthoughts.com/#install-gee-python-api.html">step-by-step instructions</a>.</p>
</blockquote>
<p>Once you have finished the authentication, follow the steps below to create a script to download data from GEE.</p>
<ol>
<li>Create a new file named <code>download_data.py</code> with the content shown below.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>import datetime
</span></span><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span>import csv
</span></span><span style="display:flex;"><span>import os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cloud_project <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;spatialthoughts&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>try:
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Initialize(project<span style="color:#f92672">=</span>cloud_project)
</span></span><span style="display:flex;"><span>except:
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Authenticate()
</span></span><span style="display:flex;"><span>    ee<span style="color:#f92672">.</span>Initialize(project<span style="color:#f92672">=</span>cloud_project)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get current date</span>
</span></span><span style="display:flex;"><span>now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the period of past 1-week</span>
</span></span><span style="display:flex;"><span>end_date <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Date(now)
</span></span><span style="display:flex;"><span>start_date <span style="color:#f92672">=</span> end_date<span style="color:#f92672">.</span>advance(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;week&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>date_string <span style="color:#f92672">=</span> end_date<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#39;YYYY_MM_dd&#39;</span>)
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ssm_{}.csv&#39;</span><span style="color:#f92672">.</span>format(date_string<span style="color:#f92672">.</span>getInfo())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Saving to current directory. You can change the path to appropriate location</span>
</span></span><span style="display:flex;"><span>output_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(filename)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>soilmoisture <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;NASA/SMAP/SPL4SMGP/007&#39;</span>)
</span></span><span style="display:flex;"><span>admin2 <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;FAO/GAUL_SIMPLIFIED_500m/2015/level2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Filter to a state</span>
</span></span><span style="display:flex;"><span>karnataka <span style="color:#f92672">=</span> admin2<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;ADM1_NAME&#39;</span>, <span style="color:#e6db74">&#39;Karnataka&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Select the ssm band</span>
</span></span><span style="display:flex;"><span>ssm  <span style="color:#f92672">=</span> soilmoisture<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;sm_surface&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered <span style="color:#f92672">=</span> ssm <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(start_date, end_date))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mean <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stats <span style="color:#f92672">=</span> mean<span style="color:#f92672">.</span>reduceRegions(<span style="color:#f92672">**</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;collection&#39;</span>: karnataka,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;reducer&#39;</span>: ee<span style="color:#f92672">.</span>Reducer<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>setOutputs([<span style="color:#e6db74">&#39;meanssm&#39;</span>]),
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;scale&#39;</span>: <span style="color:#ae81ff">11000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;crs&#39;</span>: <span style="color:#e6db74">&#39;EPSG:32643&#39;</span>
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Select columns to keep and remove geometry to make the result lightweight</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Change column names to match your uploaded shapefile</span>
</span></span><span style="display:flex;"><span>columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;ADM2_NAME&#39;</span>, <span style="color:#e6db74">&#39;meanssm&#39;</span>]
</span></span><span style="display:flex;"><span>exportCollection <span style="color:#f92672">=</span> stats<span style="color:#f92672">.</span>select(<span style="color:#f92672">**</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;propertySelectors&#39;</span>: columns,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;retainGeometry&#39;</span>: False})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>features <span style="color:#f92672">=</span> exportCollection<span style="color:#f92672">.</span>getInfo()[<span style="color:#e6db74">&#39;features&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> f <span style="color:#f92672">in</span> features:
</span></span><span style="display:flex;"><span>    data<span style="color:#f92672">.</span>append(f[<span style="color:#e6db74">&#39;properties&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>field_names <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;ADM2_NAME&#39;</span>, <span style="color:#e6db74">&#39;meanssm&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>with open(output_path, <span style="color:#e6db74">&#39;w&#39;</span>) as csvfile:
</span></span><span style="display:flex;"><span>    writer <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictWriter(csvfile, fieldnames <span style="color:#f92672">=</span> field_names)
</span></span><span style="display:flex;"><span>    writer<span style="color:#f92672">.</span>writeheader()
</span></span><span style="display:flex;"><span>    writer<span style="color:#f92672">.</span>writerows(data)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;Success: File written at&#39;</span>, output_path)
</span></span></code></pre></div><ol start="2">
<li>From the terminal, navigate to the directory where you have created the file and type the command below to run the script.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>python download_data<span style="color:#f92672">.</span>py
</span></span></code></pre></div><p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/download2.png" alt=""></p>
<ol start="3">
<li>The script will download the data from GEE and save a file to your current directory.</li>
</ol>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/download3.png" alt=""></p>
<h2 id="06-automating-exports">06. Automating Exports</h2>
<p>If you want to automate Earth Engine jobs on a server, it is preferable to use a <a href="https://developers.google.com/earth-engine/guides/service_account">Service Account</a> for authentication. A service account is a virtual account linked to a Google Cloud project. Once you create a service account and give necessary permissions, it can be used to authenticate your Earth Engine account instead of your own account. Each service account is identified by an email address in the form of <code>&lt;account_name&gt;@&lt;project&gt;.iam.gserviceaccount.com</code>. Along with them, the credentials are stored in a separate <code>.json</code> file. You need to keep this <code>.json</code> file safe on the system with appropriate permissions so external users do not have access to it.</p>
<blockquote>
<p>Before running the script, please install the Earth Engine Python Client Library on the server using our <a href="https://courses.spatialthoughts.com/#install-gee-python-api.html">step-by-step instructions</a>.</p>
</blockquote>
<p>The below code example shows how to authenticate an Earth Engine Export job using a service account. The code snippet assumes that the private key file is in the same directory as the scirpt and saved as a file named <code>.private_key.json</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-gdscript3" data-lang="gdscript3"><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replace the service account with your service account email</span>
</span></span><span style="display:flex;"><span>service_account <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;export-data-gee@spatialthoughts.iam.gserviceaccount.com&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Replace the value with the path to your private key json file</span>
</span></span><span style="display:flex;"><span>private_key_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;.private_key.json&#39;</span>
</span></span><span style="display:flex;"><span>credentials <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ServiceAccountCredentials(service_account, private_key_path)
</span></span><span style="display:flex;"><span>ee<span style="color:#f92672">.</span>Initialize(credentials)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lsib <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>FeatureCollection(<span style="color:#e6db74">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span>)
</span></span><span style="display:flex;"><span>australia <span style="color:#f92672">=</span> lsib<span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;country_na&#39;</span>, <span style="color:#e6db74">&#39;Australia&#39;</span>))
</span></span><span style="display:flex;"><span>geometry <span style="color:#f92672">=</span> australia<span style="color:#f92672">.</span>geometry()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>terraclimate <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>ImageCollection(<span style="color:#e6db74">&#39;IDAHO_EPSCOR/TERRACLIMATE&#39;</span>)
</span></span><span style="display:flex;"><span>tmax <span style="color:#f92672">=</span> terraclimate<span style="color:#f92672">.</span>select(<span style="color:#e6db74">&#39;tmmx&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">scale</span>(image):
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> image<span style="color:#f92672">.</span>multiply(<span style="color:#ae81ff">0.1</span>) \
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">.</span>copyProperties(image,[<span style="color:#e6db74">&#39;system:time_start&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tmaxScaled <span style="color:#f92672">=</span> tmax<span style="color:#f92672">.</span>map(scale)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered <span style="color:#f92672">=</span> tmaxScaled \
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>date(<span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;2021-01-01&#39;</span>)) \
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">.</span>filter(ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>bounds(geometry))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>image_ids <span style="color:#f92672">=</span> filtered<span style="color:#f92672">.</span>aggregate_array(<span style="color:#e6db74">&#39;system:index&#39;</span>)<span style="color:#f92672">.</span>getInfo()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, image_id <span style="color:#f92672">in</span> enumerate(image_ids):
</span></span><span style="display:flex;"><span>    exportImage <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>Image(filtered<span style="color:#f92672">.</span>filter(
</span></span><span style="display:flex;"><span>        ee<span style="color:#f92672">.</span>Filter<span style="color:#f92672">.</span>eq(<span style="color:#e6db74">&#39;system:index&#39;</span>, image_id))<span style="color:#f92672">.</span>first())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    clippedImage <span style="color:#f92672">=</span> exportImage<span style="color:#f92672">.</span>clip(geometry)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    task <span style="color:#f92672">=</span> ee<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>Export<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>toDrive(<span style="color:#f92672">**</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;image&#39;</span>: clippedImage,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">&#39;Terraclimate Image Export {}&#39;</span><span style="color:#f92672">.</span>format(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;fileNamePrefix&#39;</span>: image_id,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;folder&#39;</span>:<span style="color:#e6db74">&#39;earthengine&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;scale&#39;</span>: <span style="color:#ae81ff">4638.3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;region&#39;</span>: geometry,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;maxPixels&#39;</span>: <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    task<span style="color:#f92672">.</span>start()
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;Started Task: &#39;</span>, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><h2 id="07-using-the-google-earth-engine-qgis-plugin">07. Using the Google Earth Engine QGIS Plugin</h2>
<p>The <a href="https://gee-community.github.io/qgis-earthengine-plugin/">QGIS Google Earth Engine plugin</a> allows GEE Python API code to be run from QGIS and visualize the results directly in QGIS. This allows users to integrate QGIS’s rich cartographic features with the cloud data processing capabilities. After installing the plugin, you will be prompted to authenticate to GEE using your credentials. Once authenticated, you are able to run EE Python API code along with other PyQGIS code within QGIS.</p>
<blockquote>
<p>If you get an authentication error, <a href="https://courses.spatialthoughts.com/install-gee-python-api.html#authentication">follow these instructions</a> to install the Python API client and run <code>earthengine authenticate</code></p>
</blockquote>
<p>We will run a script that processes and visualizes a future climate scenario using the <a href="https://www.carbonbrief.org/cmip6-the-next-generation-of-climate-models-explained/">CMIP6 Climate Models</a>.</p>
<p>Open the QGIS Python Console from <strong>Plugins → Python Console</strong> and click the <strong>Show Editor</strong> button. Paste the following code and click the <strong>Run</strong> button. Once the code runs, the resulting image computed by Earth Engine and will be streamed to QGIS as a new layer.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/ee_qgis1.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import ee
</span></span><span style="display:flex;"><span>from ee_plugin import Map
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Use the CMIP6 Climate Projections Dataset
</span></span><span style="display:flex;"><span>cmip6 = ee.ImageCollection(&#39;NASA/GDDP-CMIP6&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Select a model and a scenario
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model = &#39;ACCESS-CM2&#39;
</span></span><span style="display:flex;"><span>scenario = &#39;ssp245&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Select the band
</span></span><span style="display:flex;"><span># Here we are using maximum air temperature
</span></span><span style="display:flex;"><span>band = &#39;tasmax&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Select the date range
</span></span><span style="display:flex;"><span>startDate = ee.Date.fromYMD(2030, 3, 1)
</span></span><span style="display:flex;"><span>endDate = startDate.advance(1, &#39;month&#39;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filtered = cmip6 \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.date(startDate, endDate)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.eq(&#39;model&#39;, model)) \
</span></span><span style="display:flex;"><span>  .filter(ee.Filter.eq(&#39;scenario&#39;, scenario)) \
</span></span><span style="display:flex;"><span>  .select(band)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Temperature values are in Kelvin
</span></span><span style="display:flex;"><span># convert to Celcius
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>def scaleValues(image):
</span></span><span style="display:flex;"><span>  return image \
</span></span><span style="display:flex;"><span>    .subtract(273.15) \
</span></span><span style="display:flex;"><span>    .copyProperties(image,
</span></span><span style="display:flex;"><span>      [&#39;system:time_start&#39;, &#39;model&#39;, &#39;scenario&#39;])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>scaled = filtered.map(scaleValues)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Calculate average daily maximum temperature
</span></span><span style="display:flex;"><span>mean = scaled.mean()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tempVis = {
</span></span><span style="display:flex;"><span>  &#39;min&#39;: 10,
</span></span><span style="display:flex;"><span>  &#39;max&#39;: 40,
</span></span><span style="display:flex;"><span>  &#39;palette&#39;: [&#39;blue&#39;, &#39;purple&#39;, &#39;cyan&#39;, &#39;green&#39;, &#39;yellow&#39;, &#39;red&#39;],
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Map.addLayer(mean, tempVis, &#39;Average Daily Maximum Air Temperature&#39;)
</span></span></code></pre></div><p>You can now use this layer in your QGIS project or Print Layout. Here’s an example of visualizing the layer on a custom globe using the <a href="https://plugins.qgis.org/plugins/GlobeBuilder/">Globe Builder Plugin</a>.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/ee_qgis2.png" alt=""></p>
<h2 id="supplement">Supplement</h2>
<p>We have a large collection of scripts that accompany this course. Visit the <a href="https://courses.spatialthoughts.com/end-to-end-gee-supplement.html">Supplement</a>.</p>
<h2 id="guided-projects">Guided Projects</h2>
<p>Below are step-by-step video-based walkthrough of implementing real-world projects using Earth Engine. You can continue their learning journey by implementing these projects for their region of interest after the class.</p>
<p><a href="https://www.youtube.com/watch?v=uoOvOPK0iro&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=8"><img src="https://img.youtube.com/vi/uoOvOPK0iro/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=uoOvOPK0iro&amp;list=PLppGmFLhQ1HJuIb7qMiKIv11HiEQhy3ha&amp;index=8">Watch the Video ↗</a></p>
<h2 id="get-the-code">Get the Code</h2>
<ol>
<li><a href="https://code.earthengine.google.co.in/?accept_repo=users/ujavalgandhi/End-to-End-Projects">Click this link</a> to open Google Earth Engine code editor and add the repository to your account.</li>
<li>If successful, you will have a new repository named <code>users/ujavalgandhi/End-to-End-Projects</code> in the <em>Scripts</em> tab in the <em>Reader</em> section.</li>
</ol>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/projects.png" alt="Code Editor After Adding the Projects Repository"></p>
<p>Code Editor After Adding the Projects Repository</p>
<p>If you do not see the repository in the <em>Reader</em> section, click <em>Refresh repository cache</em> button in your <em>Scripts</em> tab and it will show up.</p>
<p><img src="https://courses.spatialthoughts.com/images/end_to_end_gee/repository_cache.png" alt="Refresh repository cache"></p>
<p>Refresh repository cache</p>
<h2 id="project-1-calculating-rainfall-deviation">Project 1: Calculating Rainfall Deviation</h2>
<p>Calculating Rainfall Deviation from the 30-year mean using CHIRPS Gridded Rainfall Data</p>
<p><a href="https://www.youtube.com/watch?v=zHUCM3XLc6k&amp;list=PLppGmFLhQ1HJ5VhW6BZfhPX6spUcTY7SR"><img src="https://img.youtube.com/vi/zHUCM3XLc6k/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=zHUCM3XLc6k&amp;list=PLppGmFLhQ1HJ5VhW6BZfhPX6spUcTY7SR">Watch the Video ↗</a></p>
<h2 id="project-2-flood-mapping">Project 2: Flood Mapping</h2>
<p>Rapid mapping of a flood using Sentinel-1 SAR Data.</p>
<p><a href="https://www.youtube.com/watch?v=jYsK9Y4ICrY&amp;list=PLppGmFLhQ1HJzzKVS_4v8nBiXLYxAu100"><img src="https://img.youtube.com/vi/jYsK9Y4ICrY/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=jYsK9Y4ICrY&amp;list=PLppGmFLhQ1HJzzKVS_4v8nBiXLYxAu100">Watch the Video ↗</a></p>
<h2 id="project-4-landcover-analysis">Project 4: LandCover Analysis</h2>
<p>Use existing land cover products to extract specific classes and compute statistics across many regions.</p>
<p><a href="https://www.youtube.com/watch?v=B0E_dzO1J4g&amp;list=PLppGmFLhQ1HLl0St2wiOPePr58sKu0Vh1"><img src="https://img.youtube.com/vi/B0E_dzO1J4g/mqdefault.jpg" alt="Watch the Video"></a></p>
<p><a href="https://www.youtube.com/watch?v=B0E_dzO1J4g&amp;list=PLppGmFLhQ1HLl0St2wiOPePr58sKu0Vh1">Watch the Video ↗</a></p>
<h2 id="learning-resources">Learning Resources</h2>
<ul>
<li><a href="https://www.eefabook.org/">Cloud-Based Remote Sensing with Google Earth Engine: Fundamentals and Applications</a>: A free and open-access book with 55-chapters covering fundamentals and applications of GEE. Also includes YouTube videos summarizing each chapter.</li>
<li><a href="https://github.com/giswqs/Awesome-GEE">Awesome Earth Engine</a>: A curated list of Google Earth Engine resources.</li>
<li><a href="https://courses.spatialthoughts.com/gee-water-resources-management.html">Google Earth Engine for Water Resources Management</a>: Application-focused Introduction to Google Earth Engine.</li>
<li><a href="https://courses.spatialthoughts.com/gee-charts.html">Creating Publication Quality Charts with GEE</a>: A comprehesive guide on creating high-quality data visualizations with Google Earth Engine and Google Charts.</li>
</ul>
<h2 id="useful-public-repositories">Useful Public Repositories</h2>
<p>Please visit <a href="https://github.com/giswqs/Awesome-GEE">Awesome Earth Engine</a> to see a curated list of Google Earth Engine resources.</p>
<p>We also have a few recommendations of a few selected packages, which have very useful functions to make you productive in Earth Engine.</p>
<p><strong>General Purpose Packages</strong></p>
<ul>
<li><a href="https://github.com/gee-community/ee-packages-py">eepackages</a>: A set of Google Earth Engine utilities by maintained by Gennadii Donchyts for both Javascript and Python API.</li>
<li><a href="https://github.com/fitoprincipe/geetools-code-editor/wiki">geetools</a>: Tools for cloud masking, batch processing, and more</li>
<li><a href="https://github.com/gee-community/ee-palettes">ee-palettes</a>: Module for generating color palettes</li>
<li><a href="https://github.com/awesome-spectral-indices/spectral">spectral</a>: A javascript module that provides ready-to-use curated list of spectral indices for GEE.</li>
<li><a href="https://github.com/davemlz/eemont">eemont</a>: Python package that provides utility methods to create a more fluid code by being friendly with the Python method chaining.</li>
</ul>
<p><strong>Application Specific Packages</strong></p>
<ul>
<li><a href="https://github.com/rfernand387/LEAF-Toolbox/wiki">LEAF-Toolbox</a>: Google Earth Engine application that produces various Vegetation Biophysical Products, including Leaf Area Index (LAI).</li>
<li><a href="https://github.com/seanyx/RivWidthCloudPaper">RivWidthCloud</a>: Package to automate extracting river centerline and width for both Javascript and Python API.</li>
</ul>
<h2 id="debugging-errors-and-scaling-your-analysis">Debugging Errors and Scaling Your Analysis</h2>
<p>As you start implementing more complex workflows and analyze large regions - you are bound to run into scaling issues and errors such as below:</p>
<ul>
<li><em>User memory-limit exceeded</em></li>
<li><em>Computation timed-out</em></li>
<li><em>Computed value is too large</em></li>
</ul>
<p>These are usually the result of inefficient code and structure of your script. Below are my recommendations for improving your coding style and utilizing the full power of the Earth Engine infrastructure.</p>
<ul>
<li>If/else statements and for-loops should be avoided completely and replaced with filter/map/reduce. The former are sequential and will be slow. Refer to the <a href="https://developers.google.com/earth-engine/tutorials/tutorial_js_03">Function Programming Concepts</a> guide on how to restructure your code to utilize the parallel computing infratructure provided by GEE.</li>
<li>Remove any reprojection or resampling calls fro your script. Barring a few exceptions, you should not be reprojecting or resampling data. Earth Engine is designed to take care of it internally.</li>
<li>For complex analysis involving large volumes of data, you should break down your workflow into logical steps and export intermediate results. For example, if you are implementing a complex supervised classification workflow - do it in multiple stages. A) Create your composite, add required bands, normalize them and export it as an Asset. B) Import the exported composite into another script and train a classifier. Export the classified image as an Asset. C) Import the exported classified image and do accuracy assessment and visualize the results. You will be able to run your analysis much faster, experiment easily and avoid scaling errors. Refer to the <a href="https://developers.google.com/earth-engine/guides/best_practices?hl=en#export_intermediate_results">Export Intermediate Result</a> guide to learn more.</li>
<li>You may also break your export region into smaller regions (typically by admin units) and Export each region separately. For example, if you want to export results for an entire country at 30m resolution - rather than a running a large Export - you can export each Admin1 unit in your country separately. This helps with computation timed-out errors and improves overall processing time. You can start as many exports from your account as you want and they will be executed in a queue. But do not split your exports over multiple Earth Engine accounts. This is a <a href="https://developers.google.com/earth-engine/batch-task-restrictions">violation of GEE Terms of Service</a> and may result in your account getting blocked.</li>
</ul>
<p>The Earth Engine User Guide also has tips and examples of best practices. You can review the following articles to learn them.</p>
<ul>
<li><a href="https://developers.google.com/earth-engine/guides/best_practices?hl=en">Coding Best Practices</a></li>
<li><a href="https://developers.google.com/earth-engine/guides/debugging?hl=en">Debugging Guide</a></li>
</ul>
<p>The following videos are highly recommended and contain good advice on debugging and scaling workflows.</p>
<p><a href="https://www.youtube.com/watch?v=3AtnpkZTvnk"><img src="https://img.youtube.com/vi/3AtnpkZTvnk/mqdefault.jpg" alt="Earth Engine Scaling and Debugging"></a></p>
<p><a href="https://www.youtube.com/watch?v=3AtnpkZTvnk">Watch the Video ↗</a></p>
<p><a href="https://www.youtube.com/watch?v=fsez4HiOc8k"><img src="https://img.youtube.com/vi/fsez4HiOc8k/mqdefault.jpg" alt="Using Earth Engine for Very Large Computations"></a></p>
<p><a href="https://www.youtube.com/watch?v=fsez4HiOc8k">Watch the Video ↗</a></p>
<h2 id="data-credits">Data Credits</h2>
<ul>
<li><strong>Sentinel-2 Level-1C, Level-2A</strong> and <strong>Sentinel-1 SAR GRD</strong>: Contains Copernicus Sentinel data.</li>
<li><strong>TerraClimate: Monthly Climate and Climatic Water Balance for Global Terrestrial Surfaces, University of Idaho</strong>: Abatzoglou, J.T., S.Z. Dobrowski, S.A. Parks, K.C. Hegewisch, 2018, Terraclimate, a high-resolution global dataset of monthly climate and climatic water balance from 1958-2015, Scientific Data 5:170191, <a href="https://courses.spatialthoughts.com/">doi:10.1038/sdata.2017.191</a></li>
<li><strong>VIIRS Stray Light Corrected Nighttime Day/Night Band Composites Version 1</strong>: C. D. Elvidge, K. E. Baugh, M. Zhizhin, and F.-C. Hsu, “Why VIIRS data are superior to DMSP for mapping nighttime lights,” Asia-Pacific Advanced Network 35, vol. 35, p. 62, 2013.</li>
<li><strong>FAO GAUL 500m: Global Administrative Unit Layers 2015, Second-Level Administrative Units</strong>: Source of Administrative boundaries: The Global Administrative Unit Layers (GAUL) dataset, implemented by FAO within the CountrySTAT and Agricultural Market Information System (AMIS) projects.</li>
<li><strong>CHIRPS Pentad: Climate Hazards Group InfraRed Precipitation with Station Data (version 2.0 final)</strong>: Funk, Chris, Pete Peterson, Martin Landsfeld, Diego Pedreros, James Verdin, Shraddhanand Shukla, Gregory Husak, James Rowland, Laura Harrison, Andrew Hoell &amp; Joel Michaelsen. “The climate hazards infrared precipitation with stations—a new environmental record for monitoring extremes”. Scientific Data 2, 150066. <a href="https://courses.spatialthoughts.com/">doi:10.1038/sdata.2015.66</a> 2015.</li>
<li><strong>MOD13Q1.006 Terra Vegetation Indices 16-Day Global 250m</strong>: Didan, K. (2015). <em>MOD13Q1 MODIS/Terra Vegetation Indices 16-Day L3 Global 250m SIN Grid V006</em> [Data set]. NASA EOSDIS Land Processes DAAC. Accessed 2021-05-06 from <a href="https://doi.org/10.5067/MODIS/MOD13Q1.006">https://doi.org/10.5067/MODIS/MOD13Q1.006</a></li>
<li><strong>GHS Urban Centre Database 2015 multitemporal and multidimensional attributes R2019A</strong>: Florczyk A., Corbane C,. Schiavina M., Pesaresi M., Maffenini L., Melchiorri, M., Politis P., Sabo F., Freire S., Ehrlich D., Kemper T., Tommasi P., Airaghi D., Zanchetta L. (2019) European Commission, Joint Research Centre (JRC) <a href="https://data.jrc.ec.europa.eu/dataset/53473144-b88c-44bc-b4a3-4583ed1f547e">PID</a></li>
<li><strong>ESA WorldCover v100</strong>: Zanaga, D., Van De Kerchove, R., De Keersmaecker, W., Souverijns, N., Brockmann, C., Quast, R., Wevers, J., Grosu, A., Paccini, A., Vergnaud, S., Cartus, O., Santoro, M., Fritz, S., Georgieva, I., Lesiv, M., Carter, S., Herold, M., Li, Linlin, Tsendbazar, N.E., Ramoino, F., Arino, O., 2021. ESA WorldCover 10 m 2020 v100. <a href="https://doi.org/10.5281/zenodo.5571936">doi:10.5281/zenodo.5571936</a></li>
</ul>
<h2 id="references">References</h2>
<h2 id="composites">Composites</h2>
<ul>
<li>Phan, T.N.; Kuch, V.; Lehnert, L.W. Land Cover Classification using Google Earth Engine and Random Forest Classifier—The Role of Image Composition. Remote Sens. 2020, 12, 2411. <a href="https://doi.org/10.3390/rs12152411">https://doi.org/10.3390/rs12152411</a></li>
<li>D. Simonetti, U. Pimple, A. Langner, A. Marelli, Pan-tropical Sentinel-2 cloud-free annual composite datasets, Data in Brief, Volume 39, 2021, 107488, ISSN 2352-3409,<a href="https://doi.org/10.1016/j.dib.2021.107488">https://doi.org/10.1016/j.dib.2021.107488</a>.</li>
</ul>
<h2 id="supervised-classification">Supervised Classification</h2>
<ul>
<li>Shetty, S.; Gupta, P.K.; Belgiu, M.; Srivastav, S.K. Assessing the Effect of Training Sampling Design on the Performance of Machine Learning Classifiers for Land Cover Mapping Using Multi-Temporal Remote Sensing Data and Google Earth Engine. Remote Sens. 2021, 13, 1433. <a href="https://doi.org/10.3390/rs13081433">https://doi.org/10.3390/rs13081433</a></li>
<li>Kelley, L.C.; Pitcher, L.; Bacon, C. Using Google Earth Engine to Map Complex Shade-Grown Coffee Landscapes in Northern Nicaragua. Remote Sens. 2018, 10, 952. <a href="https://doi.org/10.3390/rs10060952">https://doi.org/10.3390/rs10060952</a></li>
<li>Arsalan Ghorbanian, Mohammad Kakooei, Meisam Amani, Sahel Mahdavi, Ali Mohammadzadeh, Mahdi Hasanlou, Improved land cover map of Iran using Sentinel imagery within Google Earth Engine and a novel automatic workflow for land cover classification using migrated training samples, ISPRS Journal of Photogrammetry and Remote Sensing, Volume 167, 2020, <a href="https://doi.org/10.1016/j.isprsjprs.2020.07.013">https://doi.org/10.1016/j.isprsjprs.2020.07.013</a></li>
<li>Tassi, A.; Vizzari, M. Object-Oriented LULC Classification in Google Earth Engine Combining SNIC, GLCM, and Machine Learning Algorithms. Remote Sens. 2020, 12, 3776. <a href="https://doi.org/10.3390/rs12223776">https://doi.org/10.3390/rs12223776</a></li>
<li>Cristina Gómez, Joanne C. White, Michael A. Wulder, Optical remotely sensed time series data for land cover classification: A review, ISPRS Journal of Photogrammetry and Remote Sensing, Volume 116, 2016, Pages 55-72, ISSN 0924-2716, <a href="https://doi.org/10.1016/j.isprsjprs.2016.03.008">https://doi.org/10.1016/j.isprsjprs.2016.03.008</a></li>
<li>Sherrie Wang, George Azzari, David B. Lobell, Crop type mapping without field-level labels: Random forest transfer and unsupervised clustering techniques, Remote Sensing of Environment, Volume 222, 2019, Pages 303-317, ISSN 0034-4257, <a href="https://doi.org/10.1016/j.rse.2018.12.026">https://doi.org/10.1016/j.rse.2018.12.026</a></li>
</ul>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/clippings">clippings</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/ujjwalishere" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://www.instagram.com/ujjwalnagar08/" rel="me" title="Instagram"><i data-feather="instagram"></i></a>
    <a class="border"></a><a class="soc" href="https://www.linkedin.com/in/ujjwal-nagar-india/" rel="me" title="Linkedin"><i data-feather="linkedin"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © Ujjwal |  
  </div>
</footer>
<script>
  feather.replace()
</script></div>
    </body>
</html>
